
## AWS使用简单 AD

=== 什么是 AWS Directory Service？

> - AWS Directory Service 提供了**多种方式将 Microsoft Active Directory （AD） 与其他 AWS 服务配合使用**。
> - 这些**目录存储有关用户**、**组和设备的信息**，**管理员**使用它们来**管理对信息和资源的访问**。
> - 目录服务为希望在云中**使用现有 Microsoft AD **或**轻型目录访问协议 （LDAP）** 的客户**提供多种选择**。
> - 该服务**建立**在实际的**Microsoft Active Directory之上**，并由**Windows Server 2012 R2提供支持**。
> - AWS 目录服务包括**多种目录类型供您选择**。它们是：
> * 适用于 **Microsoft Active Directory** 的 **AWS Directory Service**
> * **AD Connector**
> * **Simple AD**
> * **Amazon Cognito**

=== 适用于 Microsoft Active Directory 的 AWS Directory Service

> - 由实际的 **Microsoft Windows Server Active Directory （AD） 提供支持**，由 **AWS 在 AWS 云中管理**。
> - 它适用于 **Microsoft SharePoint、Microsoft SQL Server Always On Availability Groups 和许多 .NET 应用程序**。
> - **支持 AWS 托管应用程序和服务**，包括 **Amazon WorkSpaces、Amazon WorkDocs、Amazon QuickSight、Amazon Chime、Amazon Connect 和 Amazon Relational Database Service for Microsoft SQL Server / Oracle / PostgreSQL**。

=== AD Connector

> - 是一种**代理服务**，它提供了**一种兼容的 AWS 应用程序**（如 Amazon WorkSpaces、Amazon QuickSight 和 Amazon EC2 for Windows Server 实例）**连接到您现有的本地 Microsoft Active Directory 的简便方法**。
> - 当您想要将**现有的本地 Active Directory 与兼容的 AWS 服务配合使用时**，这是**最佳选择**。

=== Amazon Cognito

> - 是一个**用户目录**，用于**使用 Amazon Cognito 用户池**将注册和登录添加到您的**移动应用程序或 Web 应用程序**。
> - 在需要**创建自定义注册字段**并将该元数据存储在**用户目录中时使用**。
> - 此服务**可扩展以支持数亿用户**。

=== Simple AD

> - 来自 AWS Directory Service 的**独立 Microsoft AD 兼容目录**，**由 Samba 4 提供支持**。
> - 它用作云中的**独立目录**，以支持需要**基本 AD 功能**、**兼容的 AWS 应用程序的 Windows 工作负载**，或**支持需要 LDAP 服务的 Linux 工作负载**。
> - 支持**基本 AD 功能**，例如**用户帐户、组成员身份、加入 Linux 域或基于 Windows 的 EC2 实例**、**基于 Kerberos 的 SSO 和组策略**。
> - AWS **提供监控、每日快照和恢复**作为**服务的一部分**。
> - **与 Amazon WorkSpaces、Amazon WorkDocs、Amazon Quicksight 和 Amazon WorkMail 兼容**。
> - **不支持 MFA、信任关系、DNS 动态更新、架构扩展、LDAPS 通信等**。
> - **与 RDS SQL Server 不兼容**。
> - **有 2 种尺寸可供选择**。
> - 小型 - 最多**支持 500 个用户**
> - 大型 - 最多**支持 5，000 个用户**
> - **先决条件：**
> * 您的 VPC 应**至少具有 2 个子网**。要**正确安装简单 AD**，您必须将**两个域控制器安装在必须位于不同可用区的单独子网中**。此外，**子网必须位于同一 CIDR 范围内**。
> * AWS 目录服务为您**创建的域控制器**的**必要端口应处于打开状态**，以**允许它们相互通信**。
> * VPC **必须具有默认硬件租赁**。
> * **使用简单 AD 创建目录时**，AWS 目录服务**将代表您执行以下任务**：
> ** 在 VPC 中**设置基于 Samba 的目录**。
> ** 创建**用户名为“管理员”和指定密码的目录管理员帐户**。此帐户用于**管理您的目录**。
> ** 为**目录控制器创建安全组**。
> ** 创建**具有域管理员权限的帐户**。
> ** **简单 AD 将 DNS 请求转发到您 VPC 提供的 DNS 服务器的 IP 地址**。这些 DNS 服务器**将解析在您的 Route 53 私有托管区域中配置的名称**。

=== 架构图

image::/图片2/110图片/架构图.png[架构图]

== 实验步骤

=== 创建 IAM 角色以使用 Active Directory

> - 导航到**``IAM``**
> - 在**左侧菜单**中，单击**``角色``** 。单击**``创建角色``**该按钮以**创建新的 IAM 角色**。
> - 在创建角色部分，为角色选择**可信实体类型**：
> * **AWS 服务**
> * **使用案例:EC2**

image::/图片/25图片/创建IAM.png[创建IAM]

> * 单击**下一步**
> - 添加权限：现在，您可以看到**策略列表**。按名称**``AmazonSSMManagedInstanceCore``**搜索权限并添加。
> - 按名称**``AmazonSSMDirectoryServiceAccess``**搜索权限并添加。
> - 单击**下一步**
> - 角色名称：输入 **``AWS_SAD_Role``**
> - 您**已成功**按名称 AWS_SAD_Role 创建了一个 IAM 角色。
> * 注意：您可以使用**其他名称创建角色**，然后将其**附加到 EC2 实例**

---

=== 创建VPC

> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域
> - 顶部菜单**导航到 VPC**
> - 单击左侧菜单中的**您的 VPC**
> - 在这里，您可以**看到所有 VPC 的列表**，无需对现有和默认 VPC **执行任何操作**，我们将**创建一个新的 VPC**。
> - 单击**``创建 VPC``**按钮。
> * 名称标签： **输入用于向您的 VPC 标识的 VPC 名称**。例如：**``AWS_SAD_VPC``**
> * IPv4 CIDR 块： 输入 **``10.0.0.0/16``**
> * IPv6 CIDR 块： 无需更改此设置，请确保选中**"无 IPv6 CIDR 块"**
> * 租期： 无需更改此设置，请确保**选中"默认"**。
> - 现在单击**``创建 VPC``**按钮
> - **启用 DNS 主机名选项**，请单击**"操作"**按钮，然后选择**"编辑 DNS 主机名"**选项。
> - **选中"DNS 主机名"选项**，然后单击**"保存更改"**选项。

image::/图片/38图片/dns主机名.png[dns主机名]

> - 同样，单击**"操作"**按钮并选择**"编辑 DNS 解析"**选项。
> - 确保**"DNS 解析"下的**复选框**"启用"**，然后单击**保存更改**该按钮。

image::/图片/39图片/dns解析.png[dns解析]

---


=== 创建子网

> - 我们将**创建两个子网**，如下所示：
> * 对于第一个子网，单击左侧菜单中的**子网**，然后单击**创建子网**。
> ** VPC ID ：从您之前创建的列表中选择 **``AWS_SAD_VPC``**。
> ** 子网名称 ：输入名称 **``AWS_SAD_Subnet1``**
> ** 可用区 ： 选择 **``us-east-1a``**
> ** IPv4 网段：输入范围 **``10.0.1.0/24``**
> ** 单击**"创建子网"**。
> * 对于第二个子网，再次单击**"创建子网"**。
> ** VPC ID ：从您之前创建的列表中选择 **``AWS_SAD_VPC``**。
> ** 子网名称 ：输入名称 **``AWS_SAD_Subnet2``**
> ** 可用区 ： 选择 **``us-east-1b``**
> ** IPv4网段：输入范围**``10.0.2.0/24``**
> ** 单击**"创建子网"**。
> - 逐个选择**创建的子网**，然后单击**“操作”**菜单，然后选择**“编辑子网设置”**。
> - 选中**``启用自动分配公有IPv4地址``**复选框，然后单击**保存**按钮。

---

=== 创建并附加互联网网关

> - 单击左侧菜单中的**互联网网关**，然后单击**创建互联网网关**。
> * 名称标签：**``AWS_SAD_IGW``**。
> * 单击**创建互联网网关**。
> - 从列表中**选择您创建的互联网网关**
> * 单击**"操作"**。
> * 单击**附加到VPC**
> * 从列表中**选择您创建的AWS_SAD_VPC**，然后单击**连接互联网网关**。

---

=== 创建路由表

> - 从左侧菜单中**转到路由表**，然后单击**创建路由表**。
> * 名称： 输入**"AWS_SAD_RT"**。
> * VPC： 从列表中选择**"AWS_SAD_VPC"**。
> * 单击**创建路由表**。
> - 现在，将子网**关联到路由表**。
> - 单击 **"AWS_SAD_RT"**，单击**``操作``**。
> * 然后转到**"子网关联"**选项卡
> * 从列表中选择 **"AWS_SAD_Subnet1"和"AWS_SAD_Subnet2"**。
> * 单击**保存关联**。
> - 确保**不要将任何子网与主路由表关联**。
> - AWS_SAD_RT：添加允许公网流量**流向 VPC 的路由**。
> - 选择**"AWS_SAD_RT"**。
> - 转到**"路由"**选项卡，然后单击**``编辑路由``**按钮。
> - 然后单击**``添加路由``**按钮。
> - 指定**以下值**：
> * 目标：输入 **``0.0.0.0/0``**
> * 目标：从下拉菜单中选择互联网网关，选择**``AWS_SAD_IGW``**。
> * 点击**保存更改**。

image::/图片/30图片/route.png[route]

---

=== 创建简单 AD 目录

> - 顶部菜单**导航到 ``Directory Service``**
> - 在**显示的页面中**，单击按钮**设置目录**以**创建目录**。
> - Step1 - 选择**目录类型**。
> * 我们将**``Simple AD``**从显示的列表中**进行选择**，然后单击**下一步**按钮。
> - Step2 - 我们将在此处提供**目录信息**。
> * 目录类型 ： **``Simple AD``**
> * 目录大小 ： **``选择小型``**
> * 目录 DNS 名称 ：输入 **``awslabs.com``**，该名称应为**完全限定**的域名。
> * 目录 NETBIOS 名称（可选）：输入**``Awslabs``**。我们**将 EC2 实例分配给此域名**。
> * 默认管理用户：**``Administrator``**，由**系统提供**。一旦将实例添加到上面创建的域中，我们将**使用它来登录**。
> * 管理员密码：输入**``Awslabs123``**。此值用于登录具有上述域名实例的**管理员身份**。
> * 确认密码 ：输入上面提供的**``Awslabs123``**。
> * 目录描述（可选）：将其**留空**。
> * 点击**下一步**按钮。
> - Step3 - 选择 VPC 和子网。
> * VPC ：选择**``AWS_SAD_VPC``**。
> * 子网 ：选择上述步骤中**创建的 2 个子网**。
> * 点击**下一步**按钮。

image::/图片2/110图片/子网.png[子网]

> - Step4 - **审核和创建**
> * 将显示所有配置的**详细信息以供审核**，完成后单击**创建目录**按钮。
> * 完成此任务大约**需要 20 分钟**。您可以单击**“重新加载”**图标进行**检查**，完成后“状态”将显示为**“活跃”**。

image::/图片2/110图片/创建目录.png[创建目录]

> - 创建目录后，单击**目录 ID**，您将看到**详细信息**。
> - 从显示的**详细信息中**，复制我们在下一个任务中**使用DHCP选项集时所需的DNS地址**。

image::/图片2/110图片/查找详细信息.png[查找详细信息]


==== 创建简单 AD 时，将在环境中创建以下内容：

. 在 VPC 中设置了一个**基于 Samba 的目录**。
. 将创建用户名为**“管理员”**的目录**管理员帐户**。此帐户**用于管理目录**。
. 为目录控制器**创建安全组**。
. 创建名**为 AWSAdminD-xxxxxxxx 的账户**，该账户具有**域管理员权限**。AWS 目录服务**使用此账户**来执行**目录维护操作和自动化操作**，例如**拍摄目录快照和 FSMO 角色传输**。此账户的**凭证由 AWS 目录服务存储**。
. 自动**创建弹性网络接口 （ENI）** 并将其与**每个域控制器关联**。
. 创建的 ENI 是 VPC 和 AWS 目录服务域控制器 （DC） 之间**连接所必需的**，**不应删除**。
. **域控制器 （DC）** - 是响应 Windows Server 域中的**安全身份验证请求的服务器**。它是 Microsoft Windows 或 Windows NT 网络上的服务器，负责**允许主机访问 Windows 域资源**。
. 默认情况下，DC **部署在一个区域中的两个可用区中**，并**连接到 VPC**。每天**自动进行一次备份**，并**对 EBS 卷进行加密**，以**确保静态数据的安全**。
. 当 DC **发生故障时**，它们将**使用相同的 IP 地址**在**同一可用区中自动替换**，并且可以**使用最新备份执行完整 DR**。

> - AD和DC之间的**区别**。
> * AD 是一种**目录服务**，用于**存储用户和计算机等对象**。它是一个**数据库**，用于**存储 AD 域中用户和计算机的配置**。
> * DC 是**运行 AD 的服务器**。

---

=== 创建 DHCP 选项集

> - DHCP：
> * 动态主机配置协议 （DHCP） 提供了**将配置信息传递到 TCP/IP 网络上的主机的标准**。
> * DHCP 消息的选项字段**包含配置参数**，包括**域名、域名服务器和 Netbios 节点类型**。
> * AWS 建议为**您的 AWS 目录服务目录创建一个目录**，并将其分配给该**目录所在的 VPC**。它**允许该 VPC 中的任何实例**指向**指定的域和 DNS 服务器以解析其域名**。
> - 顶部菜单**导航到 VPC**
> - 在显示的 VPC **控制面板**中，您可以找到所有**可用资源的详细信息**。
> - 在左侧，单击**“DHCP 选项集”**。
> - 在显示的页面中，将**存在很少的DHCP**
> - 忽略这些，然后单击**创建 DHCP 选项集**按钮为我们的实验室创建一个。提供**以下信息**以创建一个并**附加到我们的 VPC**。
> * DHCP 选项集名称 ：输入**``AWS_DHCP``**
> * 域名 ： 输入 **``awslabs.com``**
> * 域名服务器 ：输入域名服务器，在我的情况下是**``10.0.1.86,10.0.2.136``**。这些是我们在**创建目录时生成的值**。（每次创建目录时，这些值都会有所不同）

image::/图片2/110图片/AWS_DHCP.png[AWS_DHCP]

> - 保留所有**其他选项**，然后单击**创建 DHCP 选项集**按钮创建。
> - 现在，我们需要将其**分配给 VPC**。
> - 在左侧，单击**您的 VPC**。右侧显示的页面显示**存在的VPC列表**，然后选择我们**创建的VPC**，然后单击**“操作”**菜单，然后选择**“编辑DHCP选项集”**。
> - 在显示的页面中，从下拉菜单中选择**上面创建的DHCP选项集**，然后单击**保存更改按钮**。

image::/图片2/110图片/编辑DHCP选项集.png[编辑DHCP选项集]

> - 保存更改后，我们收到**已成功更新 DHCP 选项集**的消息**提示**。

---

=== 创建和配置AD目录服务器

> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域。
> - 顶部菜单**导航到 EC2**
> - 左侧面板，单击**"实例"**，然后单击**"启动新实例"**。

==== (1)控制台启动实例

image::/图片/07图片/控制台2.png[控制台启动实例]

==== (2)选择系统镜像

image::/图片2/110图片/选择系统镜像.png[选择系统镜像]

==== (3)选择实例类型

image::/图片/07图片/配置1.png[选择实例类型]

==== (4)配置实例

> - 实例数：**输入 ``1``**
> - 网络 ： 选择**``AWS_SAD_VPC``**
> - 子网 ：保留为**``AWS_SAD_Subnet1``**
> - 自动分配公共 IP ：**"启用"**
> - 域加入目录：选择**``awslabs.com``**
> - IAM角色 ：从下拉列表中选择**``AWS_SAD_Role``**
> - 将所有**其他设置保留为默认值**。单击**"下一步：添加存储"**

==== (5)添加存储

image::https://github.com/warrenlucky/AWS-fullstack-tech/blob/main/%E5%9B%BE%E7%89%87/03%E5%9B%BE%E7%89%87/30GB%E5%82%A8%E5%AD%98.png[存]


==== (6)添加标签

> - 添加标签：点击**添加标签**按钮
> * 键：**``Name``**
> * 值：**``SADServer``**
> * 点击**``下一步:配置安全组``**

==== (7) 配置安全组

> - 添加 RDP：

----
  . 选择类型： 选择 RDP
  . 协议：TCP
  . 端口范围：3389
  . 源：选择"任何位置"
----

> - 点击下一步 `审核和启动`

==== (8) 审核启动

> - **检查**所有选定的设置，**无误点击启动**
> - 由于我们将使用**“管理员”**凭据登录到**Simple AD服务器**，因此我们**不需要创建“密钥对”**。因此，我们将在**不创建密钥对的情况下继续**。
> * 选择**“在没有密钥对的情况下继续”**。
> * **选中复选框** - **我确认**。
> - 单击**启动新实例**以**启动 EC2 实例**。

---

=== 启动 Simple AD 服务器

> - **等待 5 分钟**，使实例**稳定下来**。
> - 由于我们已将**实例加入域**，因此我们将**使用在创建目录服务时定义的凭据**。
> - 启动 EC2 实例且状态变为**“正在运行”后**，单击服务器名称旁边的**复选框**，然后**复制详细信息中显示的公有 IPv4 DNS**。
> - 确保您的计算机上有**远程桌面连接应用程序**。打开**远程桌面应用程序**。
> - 在显示的窗口中，提供**复制的公有IPv4 DNS值**，然后单击**“连接”**按钮。
> - 在显示的屏幕中，我们将使用**管理员（awslabs.com\Administrator）和密码（Awslabs123）进行登录**，然后单击**“确定”**按钮。
> - 如果输入的凭据**正确无误**，将显示**确认信息**，然后单击**“是”**按钮**登录到计算机（简单 AD 服务器）**。
> - 登录到 EC2 实例后，等待 5 分钟，让**服务器准备就绪**。
> - 现在打开**“控制面板→系统”→“安全→系统”**。在**“计算机名、域和工作组设置”**下，我们将看到域为**``awslabs.com``**。这是因为我们已经在**域目录中启动了 EC2 实例**。

image::/图片2/110图片/将看到域为.png[将看到域为]

> - **系统准备就绪后**，我们需要**安装Active Directory管理工具**。为此，请按照**下列步骤操作**：
> * 从**“开始”**屏幕打开**服务器管理器**，您将在**任务托盘**中看到一个图标。
> * 等待 2 分钟，让服务器管理器稳定下来，然后单击面板中的**“Add roles and features”**。
> * 显示**向导屏幕**，然后单击**“下一步”**按钮，因为我们**需要安装所需的工具才能使用**。
> * 在**“安装类型”**中，**保持默认**，然后单击**“下一步”**按钮。
> * 在**服务器选择中**，您将找到**一个计算机名称**，其中**分配了 AWS 私有 IP 地址**。点击**下一页**按钮。
> * 在**“服务器角色”**中，我们将**不会进行任何操作**，然后单击**“下一步”**按钮。
> * 在**“功能”**中，我们将为**实验室安装以下必需的工具**。
> * 向下滚动到存在的列表框，然后打开**“远程服务器管理工具”**、**“角色管理工具”**，选择**“AD DS”和“AD LDS 工具”**，向下滚动并**选择“DNS 服务器工具”**，然后单击**“下一步”**按钮。

image::/图片2/110图片/远程服务器管理工具.png[远程服务器管理工具]

> - 查看信息，然后选择**“安装”**以安装工具。
> - 安装将在**几分钟内完成**，然后单击**“关闭”**按钮。

image::/图片2/110图片/安装将在几分钟内完成.png[安装将在几分钟内完成]

> - 安装完成后，您将在**“管理工具”**文件夹的**“开始”**屏幕上**找到 Active Directory 域服务**和 Active Directory **轻量级目录服务工具**。
> - 在添加**用户/组**之前，先**断开与 Active Directory 服务器的连接**，**重启EC2实例**，等待几分钟，然后**使用<<域名\管理员>>和密码再次登录到 AD 服务器**。
> * 注意：如果我们**不使用管理员凭据登录并尝试打开Active Directory Users and Computers**，则会**显示一条错误消息**。因此，**我们与服务器断开连接**，**重新启动系统并使用上述凭据登录**。
> - 单击**“开始→管理工具”**，→将显示**“管理工具”**窗口。
> - 双击**``Active Directory Users and Computers``**，将显示一个新窗口，我们可以在其中**添加用户/组**。

image::/图片2/110图片/可以在其中添加用户.png[可以在其中添加用户]

> - 在上面的**屏幕截图**中，您可以看到我们**创建目录时添加的域**。
> - 要**添加用户**，请**展开域名**或**右键单击域名**并按照下面的屏幕操作，或者右键单击右侧的**“用户”**，然后单击**“新建”**。

image::/图片2/110图片/新建.png[新建]

> - 在显示的屏幕中**提供以下信息**，然后单击**“下一步”**按钮。在这里，我们将**提供基本信息**。

image::/图片2/110图片/基本信息.png[基本信息]

> - 在下一个屏幕中，为用户**提供密码 （Awslabs123）**，并选中**密码永不过期**。只需**忽略错误消息**，然后单击**“确定”**按钮。

image::/图片2/110图片/永不过期.png[永不过期]

> - 单击**“下一步”**按钮，然后单击**“完成”**按钮以**创建用户**。

image::/图片2/110图片/完成.png[完成]

---

=== 使用用户凭据进行远程登录

> - **创建用户后**，我们无法**直接使用凭据登录**。如果这样做，我们会得到**错误消息**。
> - 要**解决上述问题**，我们需要将**用户添加到具有远程桌面访问权限的“管理用户帐户”**。
> - 导航到**“控制面板”→用户帐户→用户帐户“**。在显示的页面中，单击**“管理用户帐户”**。

image::/图片2/110图片/管理用户帐户.png[管理用户帐户]

> - 单击该链接后，将**弹出一个新窗口**，允许用户**提供详细信息**。
> * 单击**“添加”**按钮将用户**添加到域中**。
> * 在显示的屏幕中，单击**“Browse”**按钮，然后在显示的窗口中输入**用户名 James**，然后单击**“检查名称”**。如果输入的用户**详细信息可用**，则会显示它，然后单击**“确定”**按钮。

image::/图片2/110图片/检查名称.png[检查名称]

> - 用户将添加到**“添加用户”**页面中，然后单击**“下一步”**按钮。
> - 在显示的**屏幕中**，保持**设置不变**，然后单击**“下一步”**按钮。
> - 在下一个屏幕中，单击**“完成”**按钮以**添加用户**。
> - 用户将**添加到域中**。

image::/图片2/110图片/将添加到域中.png[将添加到域中]

> - 现在，我们需要为**用户提供远程桌面访问**，然后单击**“高级”**选项卡。
> - 在显示的选项卡中，在**“高级用户管理”**下，单击**“高级”**按钮。

image::/图片2/110图片/高级用户管理.png[高级用户管理]

> - 将显示名为**“本地用户和组”**的新窗口，在此窗口中单击**“组”**图标，将显示**所有可用的服务**。
> - 双击**远程桌面用户**，然后在弹出窗口中单击**“添加”**按钮。在弹出的窗口中输入**用户名``James``**，然后单击**“检查名称”**进行确认，最后单击**“确定”**按钮。

image::/图片2/110图片/远程桌面用户.png[远程桌面用户]

> - 添加名称后，单击**“应用”**按钮以**保存更改**。
> - 单击**“确定”**按钮并**关闭窗口**。
> - 关闭**“本地用户和组”**窗口以及**“托管用户”**窗口。
> - 若要**查看用户帐户的更新**，请单击**“管理用户帐户”**，然后在显示的**窗口中找到获得 RDP 到系统权限的用户**。

image::/图片2/110图片/用户帐户的更新.png[用户帐户的更新]

> - 现在，**关闭 RDP 窗口**，然后**使用以下凭据再次登录到 RDP**。
> - 将登录名用作**``awslabs.com\iamesb``**，**密码**为创建时定义的**``Awslabs123``**进行登录。
> - 如果登录名**仍然**是**``awslabs.com\Administrator``**，请选择**“使用其他帐户”**。
> - 点击**“确定”**按钮，然后在显示的窗口中单击**“是”**按钮以**登录到虚拟机**。
> - 若要**确认登录**，请打开**“控制面板”→用户帐户→用户帐户**，您将找到**用户详细信息**。

image::/图片2/110图片/iamesb.png[iamesb]

---

=== 将计算机添加到AD目录

> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域。
> - 顶部菜单**导航到 EC2**
> - 左侧面板，单击**"实例"**，然后单击**"启动新实例"**。

==== (1)控制台启动实例

image::/图片/07图片/控制台2.png[控制台启动实例]

==== (2)选择系统镜像

image::/图片2/110图片/选择系统镜像.png[选择系统镜像]

==== (3)选择实例类型

image::/图片/07图片/配置1.png[选择实例类型]

==== (4)配置实例

> - 实例数：**输入 ``1``**
> - 网络 ： 选择**``AWS_SAD_VPC``**
> - 子网 ：保留为**``AWS_SAD_Subnet2``**
> - 自动分配公共 IP ：**"启用"**
> - 域加入目录：选择**``awslabs.com``**
> - IAM角色 ：从下拉列表中选择**``AWS_SAD_Role``**
> - 将所有**其他设置保留为默认值**。单击**"下一步：添加存储"**

==== (5)添加存储

image::https://github.com/warrenlucky/AWS-fullstack-tech/blob/main/%E5%9B%BE%E7%89%87/03%E5%9B%BE%E7%89%87/30GB%E5%82%A8%E5%AD%98.png[存]


==== (6)添加标签

> - 添加标签：点击**添加标签**按钮
> * 键：**``Name``**
> * 值：**``SADClient``**
> * 点击**``下一步:配置安全组``**

==== (7) 配置安全组

> - 选择一个**现有的安全组**：从列表中选择**上次创建的安全组**
> - 点击下一步 `审核和启动`

==== (8) 审核启动

> - **检查**所有选定的设置，**无误点击启动**
> * 选择**“在没有密钥对的情况下继续”**。
> * **选中复选框** - **我确认**。
> - 单击**启动新实例**以**启动 EC2 实例**。

---

=== 验证

> - 请**等待几分钟**，让实例状态**处于“正在运行”状态**。
> - 登录到**上述实例**，然后打开**“控制面板→系统和安全→系统”**在这里您将找到**“计算机名称”**。**复制该名称**并**返回到 Active Directory 服务器**。

image::/图片2/110图片/新加计算机名称.png[新加计算机名称]

> - **在 Active Directory 服务器中**，打开**“管理工具”**窗口。
> - **双击 Active Directory Users and Computers**，将**显示一个新窗口**，我们可以在**其中查看添加到``Active Directory``的计算机**。

image::/图片2/110图片/新加计算机.png[新加计算机]

> - **该名称与我们新添加到目录中的名称相同**。

---
