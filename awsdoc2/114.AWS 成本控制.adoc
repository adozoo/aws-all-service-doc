
## AWS 成本控制

=== AWS成本分配标签

> - 标签是**您**或 **AWS** 为 AWS 的**资源分配的标记**
> - 可用来**整理资源**并可以**精细化地跟踪 AWS 成本**
> - 报告上会**体现单独的附加列**，在报告中能够清晰的**了解每个标签对应的资源的成本**
> - AWS生成的**成本分配标签**
> * **自动的应用**到您创建的AWS资源
> * 使用aws前缀，如: **``aws:createBy``**
> * 创建资源前要**激活成本分配标签**，成本分配标签**才会应用到资源上**
> - **用户定义**的标签
> * 用户**自行定义的标签**
> * 以**``user``**前缀开头
> - 标签可能最多**需要24小时才能显示在Billing and Cost Management控制台**

#### AWS成本分配标签开启方法

> - AWS管理控制台点击**右上角账户名称**
> - 随后点击**账户**选项

image::/图片2/114图片/账户.png[账户]

> - 左侧面板点击**成本分配标签**选项
> - 随后点击**``启用Cost Explorer``**按钮即可

---

=== EC2启动类型

> - **On-Demand Instances （按需实例）**
> - **Reserved Instances （预留实例）**
> - **Spot Instances （竞价实例）**
> - **Scheduled Reserved Instances （计划的预留实例）**
> - **Dedicated Instances （专用的实例）**
> - **Dedicated Hosts（专用的主机）**

==== On-Demand Instances （按需实例）

> - 这是**最基本的实例计费类型**，也应该是**使用率最高的类型了**。这种实例是**用多少收费多少**，精确到秒。在实例处于停止状态的时候，AWS不会收取你关于EC2的任何费用。只有在实例处于运行状态的时候，才会产生花销。
> - 这种EC2的实例类型非常灵活，你可以在**任何时间和地点开启并使用你的实例**，然后在**不需要的时候将其终止（Terminate）**。你的消费**只取决于你使用的时间**，而**没有其他的额外成本**或者初始投资成本。
> - 在传统的数据中心内，如果你要部署一个新的应用程序，那么你可能需要先去**申请购买硬件服务器**，然后**安装操作系统**，物理接上网络甚至存储，安装和调试应用程序以及代码。
> - 这一系列的过程会消耗你**几个月甚至大半年**的时间。 而是用AWS EC2实例，你**只需要一个浏览器**，以及几分钟的操作就可以**创建你所需要的应用程序了**！
> - 如果你**不需要这个应用程序**，直接将其**删除即可**。这样的模式特别**适合初创企业开发新的应用程序**并进行试错。
> - 这也是**云计算带来的优势**。
> - On-Demand Instances （按需实例）总结特点如下：
> * **按秒收费（以前是按小时收费，现在AWS更改了），用多少收费多少**
> * EC2实例可以**根据业务需求实时增加或减少规模**
> * **不会有昂贵的初始投资成本**
> * 适合用来**部署有突发性**，**爆发性流量**的应用程序，比如双11
> * 适合用来**测试和开发新的应用程序**

==== Reserved Instances （预留实例）

> - 这种预留实例你**需要和AWS签订1年或3年的合同**，并且会以**单价低于同等规格的按需实例的价格买到预留的实例**，可以**无预付费用**、**预付部分费用**或**预付全费**。
> - Reserved Instances （预留实例）总结特点如下：
> * **更低的每小时运行成本**
> * **买断了一定的计算资源**，不会出现AWS计算资源不足而无法创建EC2的情况
> * 费用在合同期内是**固定的**，因此**费用可预期**
> * 适合需要**长期运行、稳定的、可预估的应用程序**
> * 目前预留实例还分**两种类型**，分别是**标准RI和可转换RI**。可转换RI**可以更改实例系列、操作系统、租期和付款选项，更加灵活，但是折扣率会比标准RI稍微少一些**。

==== Spot Instances （竞价实例）

> - AWS的计算资源会提供**给全球成千上万的客户**，因为客户使用**计算资源的程度不同**，也会**影响AWS的总体计算资源消耗的程度**。
> - AWS向客户提供的这种竞价实例的**每小时价格是浮动的**，在计算**资源紧张的时候价格较高**，在**计算资源较为空闲的时候价格较低**。
> - 因此客户可以**设定规则**，在实例价格低于**某个阀值的情况下申请并使用该实例**，而达到**最大的性价比**。
> - 这种实例一般比较适合仅进行**计算和分析**的任务，并且可以**随时中断**。
> - Spot Instances （竞价实例）总结特点如下：
> * **每个小时都会变化，依据是竞价实力的供需关系**
> * 可以非常**有效地降低运行EC2实例的成本（特别对于有大数量实例需求的情况下）**
> * 在其上**安装的应用程序随时可以中断**，也就是数据和任务处理结果都需要**保存在外部存储上**
> * 对实例运行**开始的时间没有太多要求**

==== Scheduled Reserved Instances （计划的预留实例）

> - 这个类型的实例和**预留实例很相似**，但不一样的地方是你可以**定义该类型的实例在每天**，**每周**，**每个月**的**某个时间段运行**，其他时间段处于关闭的状态。
> - 这种实例比较适合于例如**只在上班时间运行的应用程序**，或者**每周末进行的数据批处理等**。

==== Dedicated Instances （专用的实例）

> - 和**按需实例差不多**，但是实例会运行在**专用的AWS硬件上**。您的专用实例与属于其他 AWS 账户的实例在主机硬件级别是**实体隔离的**。

==== Dedicated Hosts（专用的主机）

> - 相当于**购买了一整台AWS的物理服务器**，针对**许可证会绑定CPU或者Socket的软件特别有用处**。

image::/图片2/114图片/Ec2启动.png[Ec2启动]

==== 新推出 Savings Plans

> - 这是一种**灵活的新折扣模式**，通过**承诺在一年或三年期限内使用特定数量（按每小时承付额衡量）的计算能力**，**换取与预留实例相同的折扣**。
> - 每种类型的计算使用量都有一个**按需价格**和一个**（更低的）Savings Plan 价格**。在承诺特定的**每小时计算使用量后**，**不超过该数量的所有使用都将按该 Saving Plan 价格收费**，**超过该数量的部分将按按需价格收费**。
> - 如果您**拥有预留实例**，则 Savings Plan 将**适用于不受 RI 覆盖的按需使用量**。
> - Savings Plans 提供**两种选择**：
> * 计算 Savings Plans 的灵活性最高，最高可帮助您节省 66% 的费用（与可转换 RI 类似）。这些计划会**自动应用于任何区域、实例系列、操作系统或租期的任何 EC2 实例**，**包括属于 EMR、ECS 或 EKS 集群的组成部分的实例，或者 Fargate 启动的实例**。例如，您无需任何操作，即可从 C4 切换到 C5 实例，将工作负载从都柏林转移到伦敦，或者从 EC2 迁移到 Fargate，同时享受 Savings Plan 价格的优惠。
> * EC2 实例 Savings Plans **适用于一个区域中的特定实例系列**，提供最大的折扣机会（最高可达 72%，与标准 RI 类似）。与 RI 一样，您的节省计划**覆盖整个区域中同一实例类型的所有实例大小（例如 c5.4xlarge 或 c5.large）**。您甚至无需对您的节省计划作出任何更改，即可从 Windows 切换到to Linux，同时继续享受优惠。

image::/图片2/114图片/savings.png[savings]

---

=== S3的成本优化

> - 根据**存储需求选择相应的存储方案**
> - 巧妙**运用S3生命周期进行成本优化**，等等

image::/图片2/114图片/S3的成本优化.png[S3的成本优化]

image::/图片2/114图片/S3的成本优化2.png[S3的成本优化2]

---
