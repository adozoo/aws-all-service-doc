## AWS EC2创建免费的VPN

=== 架构图

image::/图片2/133图片/架构图.png[架构图]

== 实验步骤

=== 启动 EC2 实例

> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域。
> - 顶部菜单**导航到 EC2**
> - 左侧面板，单击**"实例"**，然后单击**"启动新实例"**。

==== (1)控制台启动实例

image::/图片/07图片/控制台2.png[控制台启动实例]

==== (2)选择系统镜像

image::/图片2/133图片/选择系统镜像.png[选择系统镜像]

==== (3)选择实例类型

image::/图片/07图片/配置1.png[选择实例类型]

==== (4)配置实例

> - 实例数：**输入 ``1``**
> - 将所有**其他设置保留为默认值**。单击**"下一步：添加存储"**

==== (5)添加存储

image::/图片/07图片/配置2.png[添加存储]

==== (6)添加标签

> - 添加标签：点击**添加标签**按钮
> * 键：**``Name``**
> * 值：**``MyVPNServer``**
> * 点击**``下一步:配置安全组``**

==== (7) 配置安全组

> - 将**自动启用以下端口**：

image::/图片2/133图片/配置安全组.png[配置安全组]

> - 点击下一步 `审核和启动`

==== (8) 审核启动

> - **检查**所有选定的设置，**无误点击启动**
> - 选择**现有密钥对**，确认并单击**启动实例**

image::/图片/07图片/现有密钥.png[现有密钥]

> - 启动VPN服务器**可能需要几分钟时间**

---

=== 初始化 VPN 服务器

> - **SSH 连接到 EC2 实例**
> - **Please enter 'yes' to indicate your agreement [no]**:输入**yes**
> - 之后的**所有配置选项**请单击**[Enter]**保持默认。
> - 配置**完成后**，您将**自动注销服务器连接**。下次**登录时**，您应该**使用``openvpnas``作为用户名**而**不是``root``**。
> - 现在**再次SSH进入EC2实例**，但用户名**是``openvpnas``**
> * 注意：当您**创建 EC2 实例时**，SSH 到实例的**初始用户名是``root``**，当您在上述步骤中配置 VPN 时，用户名将**更改为 ``openvpnas``**
> - 设置**登录密码**
> * **``sudo passwd openvpn``**
> * 输入**新的UNIX密码**：输入**``awslabsvpn``**
> * 重新输入新的UNIX密码：输入**``awslabsvpn``**
> * 注意：openvpn是服务器中**存在的默认用户登录名**，用于**连接到VPN**，我们**将``awslabsvpn``设置为其密码**。
> - 现在以**管理员身份登录**，打开浏览器并**粘贴以下网址**
> * 语法： **``https://<IPv4 公共 IP>:943/admin/``**
> * 例子： **``https://34.203.202.136:943/admin/``**
> * 现在，您将**收到一条警告消息**，**你的连接不是专用连接**，这是因为**我们没有**为此连接**使用任何 SSL 证书**。

image::/图片2/133图片/没有.png[没有]

> - 单击**高级选项**按钮，查看**是否有“转到网站”选项**，然后单击**链接**。
> - **如果您看到没有转到网站的链接**，请在键盘中**键入``thisisunsafe``**，页面将**自动重新加载**。
> - 您将**看到一个登录页面**，**如下所示**：

image::/图片2/133图片/登录页面.png[登录页面]

> - 登录到 VPN **管理页面**
> * 用户名 ：输入**``openvpn``**
> * 密码 ： 输入**``awslabsvpn``**
> * 现在点击**登录**按钮。
> - 在**“许可协议”**页面中，单击**同意**按钮。
> - 单击左侧菜单中的**``VPN Settings``**选项。
> - 要确保**所有互联网流量都通过VPN**，请在**Routing**处设置
> * 客户端互联网流量是否应该**通过 VPN 路由**？：将按钮切换为**“是”**

image::/图片2/133图片/请在Routing处设置.png[请在Routing处设置]

> - 现在向下滚动并单击**保存设置**按钮。

---

=== 连接到 VPN

> - 在浏览器中**打开一个新标签页**。
> - 粘贴网址**``https://<IPv4 公共 IP>/``**示例：**``https://34.203.202.136``**
> - **登录VPN用户页面**：
> * 用户名 ： 输入 **``openvpn``**
> * 密码 ： 输入 **``awslabsvpn``**
> * 现在点击**登录**按钮。
> - 现在，**根据**您使用的**操作系统**下载VPN连接软件并将其**安装在本地计算机中**。
> - **打开OpenVPNConnector应用程序**，**同意条款和条件**。
> - 您将能够**看到预配置的VPN配置文件**，**打开此连接**。

image::/图片2/133图片/连接到.png[连接到]

> - 现在再次输入**用户名和密码**。
> * 用户名 ： 输入**``openvpn``**
> * 密码 ： 输入**``awslabsvpn``**
> * 单击**确认**按钮。
> - 现在您**已连接到 VPN**

image::/图片2/133图片/现在您已连接到.png[现在您已连接到]

> - 现在，您可以**使用VPN连接开始浏览**。

---
