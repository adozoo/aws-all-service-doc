
## AWS EC2 实例运行 AWS CLI 命令

=== 架构图

image::/图片2/122图片/架构图.png[架构图]

== 实验步骤

=== 创建 EC2 IAM 角色

> - 导航到**``IAM``**
> - 在**左侧菜单**中，单击**``角色``** 。单击**``创建角色``**该按钮以**创建新的 IAM 角色**。
> - 在创建角色部分，为角色选择**可信实体类型**：
> * **AWS 服务**
> * **使用案例:EC2**

image::/图片/25图片/创建IAM.png[创建IAM]

> * 单击**下一步**
> - 添加权限：现在，您可以看到**策略列表**。按名称**``AmazonEC2FullAccess``**搜索权限并添加。
> - 单击**下一步**
> - 角色名称：输入 **``EC2-cli-lab``**
> - 您**已成功**按名称 EC2-cli-lab 创建了一个 IAM 角色。
> * 注意：您可以使用**其他名称创建角色**，然后将其**附加到 EC2 实例**

---

=== 启动 EC2 实例

> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域。
> - 顶部菜单**导航到 EC2**
> - 左侧面板，单击**"实例"**，然后单击**"启动新实例"**。

==== (1)控制台启动实例

image::/图片/07图片/控制台2.png[控制台启动实例]

==== (2)选择系统镜像

image::/图片/07图片/控制台3.png[选择系统镜像]

==== (3)选择实例类型

image::/图片/07图片/配置1.png[选择实例类型]

==== (4)配置实例

> - 实例数：**输入 ``1``**
> - IAM角色：从列表中**选择我们在上面创建的 IAM 角色**。
> - 将所有**其他设置保留为默认值**。单击**"下一步：添加存储"**

==== (5)添加存储

image::/图片/07图片/配置2.png[添加存储]

==== (6)添加标签

> - 添加标签：点击**添加标签**按钮
> * 键：**``Name``**
> * 值：**``MyEC2Instance``**
> * 点击**``下一步:配置安全组``**

==== (7) 配置安全组

> - 添加 SSH：

----
  . 选择类型： 选择 SSH
  . 协议：TCP
  . 端口范围：22
  . 源：选择"任何位置"
----

> - 点击下一步 `审核和启动`

==== (8) 审核启动


> - **检查**所有选定的设置，**无误点击启动**
> - 选择现有密钥对，确认并单击**启动实例**

image::/图片/07图片/现有密钥.png[现有密钥]

---

=== 用于创建密钥对的 AWS CLI 命令

> - **SSH 连接到 EC2 实例**
> - 以下命令**将在 ``us-east-1`` 区域中创建密钥对**。
> * **``aws ec2 create-key-pair --key-name MyCLIKeyPair --query 'KeyMaterial' --region us-east-1``**
> - 获得**以下输出后**，您**已成功创建了密钥对**。

image::/图片2/122图片/创建密钥对.png[创建密钥对]

---

=== 用于创建安全组的 AWS CLI 命令

> - 以下命令**将在 ``us-east-1`` 区域中创建一个安全组**。
> * **``aws ec2 create-security-group --group-name my-sg --description "My security group" --region us-east-1``**
> - 获得**以下输出后**，您**已成功创建安全组**。

image::/图片2/122图片/创建安全组.png[创建安全组]

---

=== 用于创建 EC2 实例的 AWS CLI 命令

> - 以下命令**将在 ``us-east-1`` 区域中使用 ``Amazon Linux 2 AMI`` 创建一个 ``t2.micro`` EC2 实例**。
> * **``aws ec2 run-instances --image-id  ami-062f7200baf2fa504 --count 1 --instance-type t2.micro --key-name MyCLIKeyPair --security-groups my-sg --region us-east-1``**
> - **复制实例 ID 并将其放置在文本编辑器中**。

image::/图片2/122图片/复制实例.png[复制实例]

---

=== 查看您创建的 EC2 实例

> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域。
> - 顶部菜单**导航到 EC2**
> - 单击**左侧面板**中的**实例**。
> - 在**搜索栏中**，**粘贴实例 ID**，然后**按 [Enter] 键**
> - 您将能够**看到您创建的 EC2 实例**。

image::/图片2/122图片/查看您创建的.png[查看您创建的]

---

=== 用于删除 EC2 实例的 AWS CLI 命令

> - 以下命令**将终止之前创建的 EC2 实例**。
> * **``aws ec2 terminate-instances --instance-ids i-078b4958e04fa1e28 --region us-east-1``**
> - 注意：将**实例 ID 替换为您的实例 ID**。
> - 看到**以下输出后**，您的 EC2 实例**将终止**。

image::/图片2/122图片/终止.png[终止]

> - 现在**导航到您的 EC2 控制面板**，您将能够**看到 EC2 实例状态**更改为**“已终止”**。

image::/图片2/122图片/检查终止.png[检查终止]

---
