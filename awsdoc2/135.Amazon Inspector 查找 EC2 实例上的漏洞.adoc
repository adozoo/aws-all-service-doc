
## Amazon Inspector 查找 EC2 实例上的漏洞

=== Amazon Inspector

> - Amazon Inspector **允许我们在已配置的 EC2 实例上查找漏洞**。
> - 执行 2 种类型的**评估运行**：**网络评估和主机评估**
> - **网络评估具有网络可访问性规则包**，而**主机评估**具有**三种类型的规则包**，即**常见漏洞和暴露**、**互联网安全中心** （CIS） 基准测试、Amazon Inspector 的**安全最佳实践**。
> - Amazon Inspector中的规则主要有**三种类型的严重性级别**，即**高、中和低**。
> - **评估结果**的严重性信息及建议**只是 Amazon Inspector 推荐的最佳做法**。

=== 架构图

image::/图片2/135图片/架构图.png[架构图]

== 实验步骤

=== 启动 EC2 实例

> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域。
> - 顶部菜单**导航到 EC2**
> - 左侧面板，单击**"实例"**，然后单击**"启动新实例"**。

==== (1)控制台启动实例

image::/图片/07图片/控制台2.png[控制台启动实例]

==== (2)选择系统镜像

image::/图片/07图片/控制台3.png[选择系统镜像]

==== (3)选择实例类型

image::/图片/07图片/配置1.png[选择实例类型]

==== (4)配置实例

> - 实例数：**输入 ``1``**
> - 将所有**其他设置保留为默认值**。单击**"下一步：添加存储"**

==== (5)添加存储

image::/图片/07图片/配置2.png[添加存储]

==== (6)添加标签

> - 添加标签：点击**添加标签**按钮
> * 键：**``Name``**
> * 值：**``Inspector-EC2``**
> * 点击**``下一步:配置安全组``**

==== (7) 配置安全组

> - 添加 **SSH**

----
  . 选择类型： 选择 SSH
  . 协议：TCP
  . 端口范围：22
  . 源：选择"任何位置"
----

> - 添加 **自定义 TCP 规则**

----
  . 选择类型： 选择 自定义 TCP 规则
  . 协议：TCP
  . 端口范围：20
  . 源：选择"任何位置"
----

> - 添加 **自定义 TCP 规则**

----
  . 选择类型： 选择 自定义 TCP 规则
  . 协议：TCP
  . 端口范围：21
  . 源：选择"任何位置"
----

> - 添加 **自定义 TCP 规则**

----
  . 选择类型： 选择 自定义 TCP 规则
  . 协议：TCP
  . 端口范围：23
  . 源：选择"任何位置"
----

> - 点击下一步 **``审核和启动``**

==== (8) 审核启动

> - **检查**所有选定的设置，**无误点击启动**
> - 选择**现有密钥对**，确认并单击**启动实例**

image::/图片/07图片/现有密钥.png[现有密钥]

---

=== 安装 AWS 代理

> - **SSH 连接到 EC2 实例**
> - **切换到 root 用户**：**``sudo su``**
> - 通过运行以下命令之一**下载代理安装脚本**：
> * **``wget https://inspector-agent.amazonaws.com/linux/latest/install``**
> * **``curl -O https://inspector-agent.amazonaws.com/linux/latest/install``**
> - 若要**安装代理**，请**运行以下命令**：
> * **``sudo bash install``**

---

=== 创建评估目标

> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域。
> - 顶部菜单**导航到 Inspector**
> - 在主页上，单击**“开始使用”**按钮。
> - 单击右下角显示的**“取消”**按钮，以**进入控制面板**。
> - 在**左侧栏上**，单击**评估目标**。
> - 单击**创建**该按钮。
> - 填写**详细信息**，名称：**``Demo``**
> - **所有实例**：选择**包括此 AWS 账户和区域中的所有 EC2 实例**。
> - 安装代理：**默认选中**
> - 单击**“保存”**按钮，创建**评估目标**。

image::/图片2/135图片/评估目标.png[评估目标]

> - 单击**弹出菜单上的确定按钮**。
> - 现**已创建评估目标**。

image::/图片2/135图片/已创建评估目标.png[已创建评估目标]

---

=== 创建评估模板

> - 在左侧栏上，单击**评估模板**。
> - 单击**创建**该按钮。
> - 填写以下**详细信息**，如下所示：
> * 名称：输入**``aws``**
> * 目标名称：选择**``Demo``**
> * 规则包：选择**所有四个选项**
> * 持续时间： **``1 小时 （推荐）``**
> * 将**所有其他选项保留为默认值**。
> * 单击**“创建”**按钮。
> - 现在正在**创建评估模板 aws**。
> - 在下一步中，您将**运行模板**以**查找创建的 EC2 实例上的漏洞**。

image::/图片2/135图片/查找创建的.png[查找创建的]

---

=== 运行评估模板

> - 选择**“评估模板 aws”**，然后单击**“运行”**按钮。
> - **评估已开始运行**。
> - 若要**查看评估运行结果**，请单击左侧边栏上的**“评估运行”**。
> - 单击**评估结果的数量**，以**了解Inspector**在 EC2 实例上**发现的漏洞**。

image::/图片2/135图片/其结果.png[其结果]

> - 目前**有5个评估结果**。
> - 单击**第一个结果**的**展开**按钮，以**查看详细信息**。

image::/图片2/135图片/详细信息.png[详细信息]

> - “描述”字段包含**有关漏洞的详细信息**，而**“建议”**字段包含用于**解决问题和避免此问题的建议**。

---

=== 下载评估运行报告

> - 单击左侧边栏上的**“评估运行”**。
> - 点击**“下载报告”**按钮。

image::/图片2/135图片/下载报告.png[下载报告]

> - 单击**“下载报告”**选项后，系统将提示**您选择报告类型和格式**。
> - 保留**默认选项**，报告类型为**结果报告**，报告格式为**PDF**。单击**“生成报告”**按钮。
> - 生成报告**需要几秒钟的时间**。
> - 准备就绪后，它将在**浏览器的新选项卡中打开**。

image::/图片2/135图片/生成报告.png[生成报告]

> - 注意：严重性漏洞信息**不会显示在此报告**中。若要查看，请使用**“完整报告”**选项**重新生成报告**。
> - 如果发现**超过3个漏洞**，建议**生成报告并检查问题**。

---
