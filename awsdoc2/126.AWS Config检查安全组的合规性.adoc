
## AWS Config检查安全组的合规性

=== 什么是AWS Config?

> - AWS Config 在当前**类别和服务列表**中属于**“管理和治理”**类别。
> - Config **负责审核、评估您账户中的 AWS 资源**。
> - 根据AWS的说法，它被称为**“记录和评估您的AWS资源的配置”**。
> - AWS Config 执行**以下操作**：
> * 它**检索帐户的当前和历史配置**。
> * **针对所需设置评估 AWS 资源的配置**，并在**创建**、**修改**或**删除资源时**向您**发送通知**。
> * 它还**显示了 AWS 资源之间的关系**。

=== 架构图

image::/图片2/126图片/架构图.png[架构图]

== 实验步骤

=== 使用“一键设置”选项设置AWS Config

> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域。
> - 顶部菜单**导航到 Config**
> - **在 AWS Config的主页**上，单击**一键设置**选项。

image::/图片2/126图片/一键式设置.png[一键式设置]

> - **审核所有内容**，然后单击**“确认”**按钮以**完成设置**。
> - **设置完成后**，**``Config``** 将**发现帐户中存在的所有资源**。**``Config``**最多**需要 10 分钟才能完成发现**。

image::/图片2/126图片/发现.png[发现]

---

=== 创建配置规则

> - 在**左侧面板**上，单击 AWS Config下的**规则**。
> - 单击**添加规则**按钮。
> - 步骤 1，**指定规则类型**，选择规则类型，然后选择一个 AWS 托管规则。
> * 选择规则类型：选择**``添加 AWS 托管规则``**
> * AWS 托管规则：在**搜索框**中，键入 **ssh** 并**按 [Enter] 键**。
> * 选择名称为 **``restricted-ssh``** 的规则，然后单击**“下一步”**按钮。
> - 步骤2，**配置规则**，将**所有选项保留为默认值**，然后单击**“下一步”**按钮。
> - 步骤3，**检查并创建**，**检查设置**，然后单击下面的**添加规则**按钮。
> - 该规则**现已添加到我们的帐户中**。

image::/图片2/126图片/规则现已添加.png[规则现已添加]

> - **等待 2-3 分钟**，名为 **``restricted-ssh``** 的**规则将检查所有安全组并告知您合规性状态**。
> - 由于**只有一个安全组存在**，即账户中**存在的默认VPC的默认安全组**，因此**如果有SSH入站端口**，它将**检查它是否具有SSH入站端口**，**源是什么**。
> - **如果它是 ``0.0.0.0/0``**，则它将被**标记为不合规的资源**。**默认情况下**，它处于**未打开状态**，因此它将**是一个合规资源**。
> * 注意：如果**合规性状态**仍**未显示任何内容**，请**刷新页面**。

image::/图片2/126图片/合规性.png[合规性]

> - 让我们**创建 2 个示例安全组**，其中 **``SSH`` 作为入站端口**，以 **``0.0.0.0/0``** 作为**源**，并**检查 Config 是否会将它们标记为不合规资源**。

---

=== 创建第一个安全组

> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域
> - 顶部菜单**导航到 EC2**
> - 左侧面板，单击**"网络和安全"**，然后单击**"创建安全组"**。
> - 安全组名称：输入**``Security Group 1``**
> - 描述：**``First Security group``**
> - VPC：选择**``默认VPC``**
> - 在**"入站规则"**下，单击**"添加规则"**。
> - 添加 **SSH**

----
  . 选择类型： 选择 SSH
  . 协议：TCP
  . 端口范围：22
  . 源：选择"任何位置"
----

> - 将其他内容**保留为默认值**，然后单击**创建安全组按钮**。
> - 现**已创建安全组1**。

---

=== 创建第二个安全组

> - 现在再次单击**"创建安全组"**。
> - 安全组名称：输入**``Security Group 2``**
> - 描述：**``Second Security group``**
> - VPC：选择**``默认VPC``**
> - 在**"入站规则"**下，单击**"添加规则"**。
> - 添加 **SSH**

----
  . 选择类型： 选择 SSH
  . 协议：TCP
  . 端口范围：22
  . 源：选择"任何位置"
----

> - 将其他内容**保留为默认值**，然后单击**创建安全组按钮**。
> - 现**已创建安全组2**。

---

=== 测试安全组的合规性状态

> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域。
> - 顶部菜单**导航到 Config**
> - 在**左侧面板**上，单击 AWS Config下的**规则**。
> - 您将能够看到**规则仍处于合规状态**。

image::/图片2/126图片/合规性.png[合规性]

> - 要**获取规则的最新合规性状态**，我们需要**进行重新评估**。
> - 执行以下**任务以重新评估**：
> * **选择存在的规则**
> * 单击**操作**按钮
> * 并且，选择**“重新评估”**选项

image::/图片2/126图片/重新评估.png[重新评估]

> - **``Config``**最多可能**需要 5 分钟**才能**获取所创建安全组的合规性状态**。
> - 合规性状态现在**处于重新评估状态**，最后**将显示 2 个不合规资源**。
> * 注意：如果合规性状态**仍未显示任何内容**，请**刷新页面**。

image::/图片2/126图片/不合规资源.png[不合规资源]

> - 单击**规则**名称以查看**“不合规资源”**的**详细信息**。

image::/图片2/126图片/不符合.png[不符合]

---
