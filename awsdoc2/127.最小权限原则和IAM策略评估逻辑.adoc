
## 最小权限原则和IAM策略评估逻辑

=== 理解最小权限原则（Understanding Principle of Least Privilage）

> - 根据定义，**最小权限是指每个程序和系统用户都应该具有完成任务所必需的最小权限集合**。因此，对于系统管理员而言，一个用户**应该只能访问履行他的相关职责所需访问的数据和硬件**。
> - 所以，假设一个开发人员如果**希望访问特定的日志文件**，那么他的**权限就应该只具有访问这个特定日志文件的权限**，他**不应该能够做其他的操作**，去获得**未经授权的额外信息**。
> - **赋予每一个合法动作最小的权限，就是为了保护数据以及功能，避免受到错误或者恶意行为的破坏**。
> - 然而，在大部分组织**实际的工作中**，真正的**普遍情况**是，当一个开发人员或者其他相关人员请求**开通访问权限时**，系统管理员或者解决方案架构师都是**盲目的提供了访问权限且没有限制**，这样就导致了在**组织内部有很多的漏洞**，极有可能会造成**重大安全风险**。
> - 接下来我们看一个**简单的案例**
> * 您的组织来了一个**新的实习生**，名为张三，岗位是**实习系统管理员**。组织的基础设置**托管在AWS**，您需要让这个实习生通过访问**查看AWS管理控制台尽快熟悉岗位工作内容**，要问的问题是，您会给他分配哪种类型的**访问权限**？有三个选项，
. 第一个是你和他**共享AWS的ROOT凭证**，这种方式可以肯定能满足需求；
. 第二个选项，给他**建立一个新的张三用户**，并**分配完全访问权限**，如果比较第二个选项和第一个选项，你会发现**第二个选项好一些**，因为我们在设计用户权限的时候，尽量不要共享凭证，也就是说不要和其他用户使用一套用户登陆凭证，因为这样当需要的时候**很难对具体使用者的操作和行为进行追踪**。
. 第三个选项，**建立一个新的张三用户**，并**分配只读访问权限**，对于这个案例，很显然这个选项就**足够了满足需求了**。
> - 所以您要了解，每当有人像您**请求访问权限时**，您**只需要提供给他匹配他需求的权限**。

---

=== IAM策略评估逻辑（IAM Policy Evaluation Logic）

==== 策略决策图

image::/图片2/127图片/策略决策图.png[策略决策图]

==== 策略决策图（1，2步解析）

> - 首先，**``Decision starts with Deny``**，在AWS，**所有的访问比如访问S3存储桶**，或者是**启动EC2实例等**，**默认情况下这些请求都会被拒绝**，默认的情况下，所有请求都被拒绝，这称为**隐式拒绝**。
> - 在**默认所有请求都被拒绝之后**，进行到**第二步**，开始**评估附加到用户或IAM策略**。
> - 当策略中有**显示拒绝**时，那么将**最终拒绝请求**；如果**没有显示拒绝时**，如果**有允许语句**，则**最终允许请求**。如果**没有允许所请求的操作**，则请求**最终会被隐式拒绝**。

image::/图片2/127图片/策略决策图2.png[策略决策图2]

==== 显式拒绝和默认拒绝的区别

> - 如果**没有允许访问该资源的策略**，那么这个**请求默认是会被拒绝的**。比如一个用户如果**没有附加任何S3策略**，这个用户**试图访问S3控制台时**，这个**请求默认被拒绝**，这就是**默认拒绝**。
> - 显式拒绝:我们**创建了策略**，且在**策略中明确指定了拒绝语句**，**拒绝该存储桶的访问**，这个就是**显式拒绝**。

---
