## Windows 实例创建并连接到 Amazon FSx

=== 什么是Amazon FSx？

> - Amazon FSx 是为 **Windows 提供的文件服务器**。
> - 它是一个**完全托管、高度可扩展**且**非常可靠的文件存储系统**，可通过 **SMB 协议的工业标准服务器**消息块**进行访问**。
> - 它**建立在Windows Server上**，提供了**广泛的管理功能**，如**用户kotas**，**最终用户文件系统**和**Microsoft Active Directory**集成。
> - 它还提供**单可用区和多可用区**部署选项。
> - 它具有**完全托管的备份**和**加密传输中的静态数据**。
> - 成本可以优化，工作负载的性能**需要SSD和HDD存储**选项。
> - 您还可以**随时扩展存储**并**更改文件系统的吞吐量性能**。
> - Amazon FSx 文件存储**可从 Windows 访问**，但我们**也可以从 Linux 和 Mac OS 计算实例**以及运行在 **AWS 或本地的设备访问它**。
> - 它的存储容量为 **32 GB 到 64 TB**。

=== 架构图

image::/图片/28图片/架构图.png[架构图]

== 实验步骤

=== 创建 IAM 角色

> - 导航到``IAM``
> - 在**左侧菜单**中，单击``角色`` 。单击``创建角色``该按钮以**创建新的 IAM 角色**。
> - 在创建角色部分，为角色选择**可信实体类型**：
> * **AWS 服务**
> * **使用案例:EC2**

image::/图片/25图片/创建IAM.png[创建IAM]

> * 单击**下一步**
> - 添加权限：现在，您可以看到**策略列表**。按名称**AmazonFSxFullAccess**搜索权限后添加
> - 添加权限：按名称**AmazonSSMManagedInstanceCore**搜索权限后添加
> - 添加权限：按名称**AmazonSSMDirectoryServiceAccess**搜索权限后添加
> - 注意：**请勿添加上述策略以外的其他策略**。
> - 单击**下一步**
> - 角色名称：输入 **FSx-role**
> - 您**已成功**按名称 FSx-role 创建了一个 IAM 角色。
> * 注意：您可以使用**其他名称创建角色**，然后将其**附加到 EC2 实例**
> - 您已成功**创建角色以访问 Amazon FSx**。

---

=== 为 FSx 创建AD目录服务

> - 让我们**创建一个 Active Directory**，**用于文件系统的用户身份验证**和**访问控制**。
> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域。
> - 顶部菜单**导航到 目录服务**
> - 单击**设置目录**。
> - 在"选择目录类型"下
> * 目录类型 ： 选择 **AWS Managed Microsoft AD**
> * 单击"下一步"。
> - 在**"输入目录信息"**下，
> * 版本 ： 选择**标准版**
> * 目录 DNS 名称 ： 输入 **awsFSxAD.com**
> * 目录 NetBIOS 名称 ： 输入 **awsFSxAD**
> * 目录描述 - 可选 ： 输入 **awslabs FSx lab Active directory**
> * 管理员密码：输入**awslabs@123**
> * 确认密码： 输入**awslabs@123**
> * 在记事本中**记下密码以供将来使用**。
> - 单击"下一步"。
> - 在选择 VPC 和子网下，
> * 将 VPC 和子网**保留为默认值**。
> * 单击"下一步"。
> - 在**"审核和创建"**下，
> * **查看所有设置**。
> - 单击**创建目录**。
> - 创建AD目录大约需要15-20分钟。等到目录的状态为**"活跃"**

image::/图片/28图片/ad成功.png[ad成功]

---

=== 创建安全组

> - 让我们为 EC2 实例和 FSx 文件系统**创建一个安全组**。
> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域。
> - 顶部菜单**导航到 EC2**
> - 到左侧面板上"网络和安全"下的安全组，然后单击**``创建安全组``**按钮 。
> - 创建 FSx 文件系统时，安全组应**具有以下规则**，以允许**以下端口上的出站网络流量**，如屏幕截图所示。

image::/图片/28图片/安全组条目fsx.png[安全组条目fsx]

> - 但是，**出于演示目的**，我们添加了**"所有流量"规则**。
> - 在"基本详细信息"下，
> * 安全组名称：输入**aws_SG**
> * 描述 ： 输入**Allows All traffic for demo purpose**
> * VPC：**默认VPC**
> - 在"入站规则"下，
> - 单击**"添加规则"**。
> - 添加 RDP：

----
  . 选择类型： 选择 RDP
  . 协议：TCP
  . 端口范围：3389
  . 源：选择"任何位置"
----

> - 添加所有流量，

----
  . 选择类型： 选择 所有流量
  . 协议：全部
  . 端口范围：全部
  . 源：选择"任何位置"
----

> - 将所有**其他设置保留为默认值**，然后单击**``创建安全组``**。

---

=== 创建 Windows EC2 实例以访问文件系统

> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域。
> - 顶部菜单**导航到 EC2**
> - 左侧面板，单击**"实例"**，然后单击**"启动新实例"**。

==== (1)控制台启动实例

image::/图片/07图片/控制台2.png[控制台启动实例]

==== (2)选择系统镜像

image::https://github.com/warrenlucky/AWS-fullstack-tech/blob/main/%E5%9B%BE%E7%89%87/03%E5%9B%BE%E7%89%87/windows%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F.png[选择系统镜像]

==== (3)选择实例类型

image::/图片/07图片/配置1.png[选择实例类型]

==== (4)配置实例

> - 实例数：**输入 2**
> - 域加入目录 ：选择我们之前创建的 **awsFSxAD.com**。
> - IAM 角色 ：选择我们之前创建的 **FSx-role**。

==== (5)添加存储

image::https://github.com/warrenlucky/AWS-fullstack-tech/blob/main/%E5%9B%BE%E7%89%87/03%E5%9B%BE%E7%89%87/30GB%E5%82%A8%E5%AD%98.png[存]

==== (6)添加标签

image::/图片/07图片/配置3.png[添加标签]

==== (7) 配置安全组

> - 单击**"选择一个现有的安全组"**，选择**"aws_SG"**

==== (8) 审核启动

> - **检查**所有选定的设置，**无误点击启动**
> - 选择现有密钥对，确认并单击**启动实例**

image::/图片/07图片/现有密钥.png[现有密钥]

> - 然后单击每个实例，然后输入名称为 **aws_FSx_Read，aws_FSx_Write** 以**避免混淆**
> - 因为我们将在每个实例中**执行不同的任务**。

image::/图片/28图片/ec2.png[ec2]

---

=== 创建 Amazon FSx 文件系统

> - 让我们**创建一个 Amazon FSx 文件系统**。
> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域。
> - 通过单击"存储"部分下的"服务"菜单导航到 **FSx**。
> - 单击**"创建文件系统"**。
> - 在**"选择文件系统类型"**下，
> * 文件系统选项 ：选择 **Amazon FSx for Windows File Server**
> * 您将获得有关文件系统选项的信息，您可以**浏览**。
> * 单击"下一步"。
> - 在**"文件系统详细信息"**下，
> * 文件系统名称：输入 **awsFSx**
> * 部署类型 ： 选择**单可用区**
> ** 将**单可用区 2** 保留为**默认值**。
> * 存储类型 ： 选择**固态硬盘(SSD)**
> * 存储容量：输入 **32 GB**
> * 吞吐量：将其**保留为默认值**

image::/图片/28图片/fsx创建.png[fsx创建]

> - 在**"网络和安全性"**下，
> * 虚拟私有云 （VPC）：**默认**
> * VPC 安全组 ：**删除默认安全组**，然后选择之前创建的**aws_SG安全组**。（重要）
> * 将"子网"保留为**默认值**。
> - 在**"Windows 身份验证"**下，
> * 选择 **AWS Managed Microsoft Active Directory**。
> * 从**下拉列表**中选择 **awsFSxAD.com**

image::/图片/28图片/身份验证.png[身份验证]

> - 将所有**其他设置保留为默认值**。
> - 单击标签并**添加标签**。
> * 键 ： 输入**Info**
> * 值 ： 输入**awsFSx**
> - 单击**"下一步"**。
> - **查看所有设置**，然后单击**"创建文件系统"**。
> - 创建文件系统大约需要 15-20 分钟。等到文件系统的状态为**"可用"**。

image::/图片/28图片/fsx成功.png[fsx成功]

---

=== 连接到aws_FSx_Write实例并映射实例上的文件共享

> - 现在，您可以将 Amazon FSx 文件系统挂载到**加入到 AWS Directory Service 目录**中的基于 Microsoft Windows 的 Amazon EC2 实例。让我们先**连接到实例**。

==== 连接到aws_FSx_Write

> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域。
> - 顶部菜单**导航到 EC2**
> - 左侧面板，单击**"实例"**，单击**"aws_FSx_Write"**然后单击连接。
> - 选择"RDP客户端",单击获取密码以**获取密码**，这将帮助您在**启动实例时登录**

image::https://github.com/warrenlucky/AWS-fullstack-tech/blob/main/%E5%9B%BE%E7%89%87/03%E5%9B%BE%E7%89%87/%E8%BF%9E%E6%8E%A5%E7%95%8C%E9%9D%A2.png[获取密码]

> - 上传启动EC2密钥进行**解密**

image::https://github.com/warrenlucky/AWS-fullstack-tech/blob/main/%E5%9B%BE%E7%89%87/03%E5%9B%BE%E7%89%87/%E8%8E%B7%E5%8F%96%E5%AF%86%E7%A0%81.png[解密]

> - 用户名和密码将显示在**对话框中**

image::https://github.com/warrenlucky/AWS-fullstack-tech/blob/main/%E5%9B%BE%E7%89%87/03%E5%9B%BE%E7%89%87/%E5%8F%AF%E4%BB%A5%E8%BF%9E%E6%8E%A5%E4%BA%86.png[连接了]

> - 确保您的计算机上已有 `远程桌面应用程序`
> - 打开 `远程桌面应用程序`
> - 键入 `Public DNS`

image::https://github.com/warrenlucky/AWS-fullstack-tech/blob/main/%E5%9B%BE%E7%89%87/03%E5%9B%BE%E7%89%87/%E6%89%93%E5%BC%80%E8%BF%9E%E6%8E%A5%E5%B7%A5%E5%85%B7.png[]

> - 键入 `用户名` `密码` **连接**

image::https://github.com/warrenlucky/AWS-fullstack-tech/blob/main/%E5%9B%BE%E7%89%87/03%E5%9B%BE%E7%89%87/%E8%BE%93%E5%85%A5%E5%AF%86%E7%A0%81%E8%BF%9E%E6%8E%A5.png[连接]

> - 现在，您已**成功连接**到远程桌面实例。

---

=== 映射实例上的文件共享

> - 通过单击**"存储"**部分下的**"服务"**菜单**导航到 FSx**。
> - **选择我们之前创建的文件系统**。就我而言，awsFSx。
> - 单击**"挂载"**。
> - 对于已加入 Active Directory 的单可用区文件系统以及任何多可用区文件系统，DNS 名称**如下所示**。
> * **amznfsxg5tqzsgm.awsFSxAD.com**
> - 复制从"\\"开始的命令并将其粘贴到**记事本中**。就我而言
> * **\\amznfsxg5tqzsgm.awsFSxAD.com\share**
> * **\\DNS-NAME\share（share是 FSx 的默认文件夹）**

image::/图片/28图片/挂载命令.png[挂载命令]

> - 导航到**远程桌面**。
> - 单击**文件资源管理器**。
> - 单击**"这台电脑"**。
> - 在顶部，单击"计算机"，然后从子部分中选择**"映射网络驱动器"**。

image::/图片/28图片/windows.png[windows]

> - 将我们之前**复制的命令粘贴到文件系统中**。就我而言
> * **\\amznfsxg5tqzsgm.awsFSxAD.com\share**

image::/图片/28图片/连接fsx.png[连接fsx]

> - 单击"完成"后，系统将要求您提供**网络凭据**。在这里，您需要提供**AD目录的详细信息**。
> * 用户名：输入**Admin（所有微软托管AD的默认值）**
> * 密码 ：输入**awslabs@123**（这是我们在创建AD时使用的管理员密码）。请确保提供**正确的密码**。
> * 单击**"确定"**。
> - 您可以看到**创建的文件夹**。

image::/图片/28图片/fsx进入.png[fsx进入]

> - 导航到"此电脑"。您可以在**"网络位置"**下看到该**文件夹**。

image::/图片/28图片/thispc.png[thispc]

> - 现在，让我们**创建一些示例文件夹和文件**。
> - 双击要打开的**共享文件夹**。通过右键单击"新建>文件夹>新建文件夹"。 给一个名字，awslabs，然后点击Enter。
> - 以同样的方式，**创建 2 或 3 个文件夹**。

image::/图片/28图片/fsx文件夹.png[fsx文件夹]

> - 打开**任何文件夹并创建一个文件**。为此，请右键单击"新建>>新建文本文档"。给出一个名称。
> - 双击文本文件并**编写一些**内容并将其保存在"文件"中。

image::/图片/28图片/test.png[test]

> - **关闭所有文件夹**。

---

=== 连接到aws_FSx_Read实例并通过文件系统访问文件

> - 让我们连接到读取实例并将文件系统挂载到它。**挂载文件系统后**，我们应该能够**看到我们在写入实例中创建的文件夹和文件**。

==== 连接到aws_FSx_Read

> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域。
> - 顶部菜单**导航到 EC2**
> - 左侧面板，单击**"实例"**，单击**"aws_FSx_Read"**然后单击连接。
> - 选择"RDP客户端",单击**获取密码**以获取密码，这将帮助您在**启动实例时登录**

image::https://github.com/warrenlucky/AWS-fullstack-tech/blob/main/%E5%9B%BE%E7%89%87/03%E5%9B%BE%E7%89%87/%E8%BF%9E%E6%8E%A5%E7%95%8C%E9%9D%A2.png[获取密码]

> - 上传启动EC2密钥进行**解密**

image::https://github.com/warrenlucky/AWS-fullstack-tech/blob/main/%E5%9B%BE%E7%89%87/03%E5%9B%BE%E7%89%87/%E8%8E%B7%E5%8F%96%E5%AF%86%E7%A0%81.png[解密]

> - 用户名和密码将**显示在对话框中**

image::https://github.com/warrenlucky/AWS-fullstack-tech/blob/main/%E5%9B%BE%E7%89%87/03%E5%9B%BE%E7%89%87/%E5%8F%AF%E4%BB%A5%E8%BF%9E%E6%8E%A5%E4%BA%86.png[连接了]

> - 确保您的计算机上已有 `远程桌面应用程序`
> - 打开 `远程桌面应用程序`
> - 键入 `Public DNS`

image::https://github.com/warrenlucky/AWS-fullstack-tech/blob/main/%E5%9B%BE%E7%89%87/03%E5%9B%BE%E7%89%87/%E6%89%93%E5%BC%80%E8%BF%9E%E6%8E%A5%E5%B7%A5%E5%85%B7.png[]

> - 键入 `用户名` `密码` **连接**

image::https://github.com/warrenlucky/AWS-fullstack-tech/blob/main/%E5%9B%BE%E7%89%87/03%E5%9B%BE%E7%89%87/%E8%BE%93%E5%85%A5%E5%AF%86%E7%A0%81%E8%BF%9E%E6%8E%A5.png[连接]

> - 现在，您**已成功连接**到远程桌面实例。

---

=== 映射实例上的文件共享

> - 通过单击"存储"部分下的"服务"菜单**导航到 FSx**。
> - 选择我们之前创建的文件系统。就我而言，awsFSx。
> - 单击**"挂载"**。
> - 对于已加入 Active Directory 的单可用区文件系统以及任何多可用区文件系统，DNS 名称**如下所示**。
> * **amznfsxg5tqzsgm.awsFSxAD.com**
> - 复制从"\\"开始的命令并将其粘贴到**记事本中**。就我而言
> * **\\amznfsxg5tqzsgm.awsFSxAD.com\share**
> * **\\DNS-NAME\share（share是 FSx 的默认文件夹）**

image::/图片/28图片/挂载命令.png[挂载命令]

> - 导航到**远程桌面**。
> - 单击**文件资源管理器**。
> - 单击**"这台电脑"**。
> - 在顶部，单击"计算机"，然后从子部分中选择**"映射网络驱动器"**。

image::/图片/28图片/windows.png[windows]

> - 将我们之前**复制的命令粘贴到文件系统中**。就我而言
> * **\\amznfsxg5tqzsgm.awsFSxAD.com\share**

image::/图片/28图片/连接fsx.png[连接fsx]

> - 单击"完成"后，系统将要求您提供**网络凭据**。在这里，您需要提供**AD目录的详细信息**。
> * 用户名：输入**Admin（所有微软托管AD的默认值）**
> * 密码 ：输入**awslabs@123**（这是我们在创建AD时使用的管理员密码）。请确保提供**正确的密码**。
> * 单击**"确定"**。
> - 您可以看到我们**在写入实例中创建的文件夹和文件**

image::/图片/28图片/fsx文件夹.png[fsx文件夹]

> - 您可以通过右键单击共享文件夹>断开连接来**断开与网络的连接**。

---
