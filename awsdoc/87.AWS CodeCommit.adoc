
## AWS CodeCommit

=== AWS CodeCommit

> - AWS CodeCommit 是由 AWS 提供的**一项版本控制基础设施服务**，用于将**您的数据（如文档、文件和源代码）安全**、**私密地**保存在云中，即**内部存储库**中。
> - 它是一种**具有 GIT 标准功能**的**托管服务**，也可以与**现有的 GIT 存储库**无缝协作。
> - 它可以**安全地存储具有任何类型扩展的任何类型的代码**，并且**限制较少**。
> - **存储在 AWS CodeCommit 中的数据经过加密**，因此**高度安全**且**不易受到外部攻击**。
> - 它**允许访问控制**在**协作环境**中工作。
> - 它可以**轻松缩放**。
> - 它**允许**我们**将数据与其他第三方工具集成**。

=== 架构图

image::/图片/87图片/架构图.png[架构图]

== 实验步骤

=== 先决条件

> - 您需要在**本地PC**上**下载并安装git软件**。您可以**根据您的操作系统单击以下链接进行相应的下载**
> * https://git-scm.com/download/[Git工具官方下载]

=== 创建 AWS CodeCommit存储库

> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域
> - 顶部菜单**导航到 CodeCommit**
> - 在**"CodeCommit"**面板中，单击**"创建存储库"**并**提供以下详细信息**。
> * 存储库名称：**``aws_repo``**
> * 描述：**``Creating a demo repository``**
> * 标签： 点击**添加**
> ** 键：**``Name``**
> ** 值：**``my_first_repo``**
> * 单击**"创建"**按钮。

image::/图片/87图片/创建存储库.png[创建存储库]

> - 单击**"创建"**后，您将导航到**连接步骤**页面。
> - 有 3 种类型的连接，**HTTPS、SSH 和 HTTPS （GRC）** 。我们将**使用 HTTPS 连接**执行此**练习**。

---

=== 配置 IAM 用户以访问CodeCommit

> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域
> - 顶部菜单**导航到 IAM**
> - 单击**``添加用户``**该按钮以**创建新的 IAM 用户**。

image::/图片/59图片/创建用户.png[创建用户]

> - 在**添加用户**部分，**设置用户详细信息**：
> - 用户名：**``CODETEST``**
> - 在选择 **AWS 访问类型**部分，选择 **AWS 凭证类型**为**``访问密钥 - 编程访问和密码 - AWS 管理控制台访问``**

image::/图片/87图片/添加用户.png[添加用户]

> * 单击**下一步**
> - 设置权限：现在，您可以看到**策略列表**。
> - 单击**直接附加现有策略**，搜索**``AWSCodeCommitPowerUser``**并选择它
> - 现在点击 **下一页：标签**按钮。**无需更改**
> - 单击**"下一步：审核"**按钮。
> - **查看选择是否有误**，然后单击**"创建用户"**。
> - 会得到**访问密钥 ID-私有访问密钥和用户密码**
> - 请**保存好它**


---

=== 为 AWS CodeCommit 生成和下载 HTTPS Git 凭证

> - 安装 Git 后，我们需要**在 IAM 中**为您的 IAM 用户**创建 Git 凭证**。
> - **导航到 IAM**。
> - 在 IAM 控制台中，选择**用户**，然后单击**名称为``CODETEST的用户``**。
> - 导航到**安全证书**选项卡，然后在**``AWS CodeCommit``**的**``HTTPS Git``**凭证中，单击**生成凭证**。

image::/图片/87图片/生成git.png[生成git]

> - 将生成的**"用户名"**和**"密码"**复制并粘贴到**本地计算机**上的文件中，或选择**"下载凭据"**以将此信息**下载为.csv文件**。
> - 连接到 CodeCommit **需要这些凭据**。**保存凭据**后，可以单击**"关闭"**。

---

=== 连接到 CodeCommit 并克隆存储库


> - 顶部菜单**导航到 CodeCommit**
> - 确保您位于**创建 CodeCommit 存储库的同一区域**，即**弗吉尼亚北部**地区。
> - 单击**创建的存储库**，然后将用于将**存储库克隆到本地计算机的 URL 复制**。

image::/图片/87图片/复制clone.png[复制clone]

> - 打开**终端**、**命令行**或**Git shell**。导航到要**克隆存储库的文件夹**。
> - 在我的**情况**下，我使用命令**``cd Desktop``**更改为桌面。通过键入**pwd**命令**确认位置**。
> - 使用之前复制的 URL 运行 git 克隆命令以**克隆存储库**。
> * 语法：**``git clone Copied_URL <空格> desired_name_in_your_local``**
> * 示例：**``git clone https://git-codecommit.us-east-1.amazonaws.com/v1/repos/aws_repo awsrepo``**
> * 注意：请注意URL末尾的名称**awsrepo**，它将使用您提供的路径中的**名称awsrepo**将**远程存储库**的内容克隆到您的本地计算机
> * 即在我的情况下，它将在**桌面/awsrepo**中。 该名称是可以**自由选择的**。
> - 单击[Enter]后，它将**询问用户名和密码**。提供我们之前下载的**AWS CodeCommit**的 HTTPS 凭证的**用户名和密码**。

image::/图片/87图片/克隆成功.png[克隆成功]

> - 提供凭据并**单击[Enter]后**，**aws_repo**的内容将被**克隆**到名为``awsrepo``的**本地存储库**中。

---

=== 在本地存储库中创建文件并推送到远程存储库主分支

> - 导航到已克隆远程存储库的**文件夹**。
> - **创建**两个名为**``file1.txt`` 和 ``file2.txt`` 的文本文件**
> * **``echo “This is a sample file 1” > file1.txt``**
> * **``echo “This is a sample file 2” > file2.txt``**
> - 现在我们需要使用以下命令将文件添加到git中
> * **``git add file1.txt file2.txt``**
> - 提交带有注释的测试.txt文件
> * **``git commit -m "my first document"``**
> - 将文件推送到远程存储库的主分支中
> * **``git push origin master``**

image::/图片/87图片/添加1.png[添加1]

> - 导航到**CodeCommit**控制台中**创建的存储库**并**刷新页面**。
> - 验证主分支的内容，该分支将包含文件**``file1.txt``和``file2.txt``**

image::/图片/87图片/检验1.png[检验1]

---

=== 创建新分支，创建文件并将其推送到新分支的远程存储库

> - 使用以下命令**创建**名称**second_branch的新分支**
> * **``git branch second_branch``**
> - 使用以下命令从**主节点切换到到新分支**
> * **``git checkout second_branch``**
> - 使用以下命令**验证**您**是否在新分支中**
> * **``git branch``**

image::/图片/87图片/分支.png[分支]

> - 确保**在克隆目录中**
> - 尝试创建一个**名称为sample.txt并添加**、**提交并推送**到远程存储库的**辅助分支**（即second_branch）
> * **``echo “Hello world” > sample.txt``**
> * **``git add sample.txt``**
> * **``git commit -m "my second document"``**
> * **``git push origin second_branch``**

image::/图片/87图片/添加2.png[添加2]

> - 导航到 CodeCommit 控制台中**创建的存储库**并**刷新页面**。
> - 您将能够看到**创建的新分支**。**选择分支``second_branch``**。

image::/图片/87图片/检验分支.png[检验分支]

> - **验证样本文件**

image::/图片/87图片/检验2.png[检验2]


---
