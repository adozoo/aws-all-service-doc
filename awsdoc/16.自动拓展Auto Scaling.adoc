
## 自动拓展Auto Scaling


=== 什么是 Amazon EC2 Auto Scaling?

> - Amazon EC2 自动扩展设计为**一项完全托管的服务**，用于**控制正在运行的实例**的数量，如果您的**工作负载较高**，它将通过**立即启动更多实例**来匹配。
> - 与负载均衡器不同，您**不会提前预置** EC2 实例并注册为目标，而是在启动模板中**定义整个配置**，该配置将**根据流量**进行**横向扩展或缩减**。
> - 在自动缩放中，您还可以定义最小容量、所需容量和最大容量。自动缩放**可确保在流量正常时**，所需容量中指定的实例数**始终处于运行状态**，在流量最低时将**缩减**，在运行时出现峰值时**横向扩展**。
> - 创建自动扩展时，它**需要一个启动模板**，您可以在其中指定要选择的 AMI、实例类型、关联的安全组以及启动 EC2 实例所需的所有其他选项（包括密钥对）。


=== 启动模板 （LT） 和启动配置 （LUC） 之间的区别是什么?

> - AWS **建议使用启动模板 （LT）**而不是启动配置 （LUC），因为 LT 提供了**最新的功能**。
> - **启动配置** **本质上是不可变的**，一旦创建，就无法编辑它们，因此替换只是选项。在 Launch 模板提供版本控制的情况下，您可以**一次创建多个版本**，并将其中一个版本**作为默认版本**以供使用。
> - 使用启动模板，您可以使用 T2 **无限突发**功能。
> - 启动模板**允许**预置**按需实例**和**竞价型实例**。
> - 启动模板与 AWS 管理控制台、AWS 开发工具包和 AWS CLI **兼容**。


=== 架构图

image::/图片/16图片/架构图.png[架构图]


== 实验步骤

=== 创建启动模板

> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域。
> - 顶部菜单导航到 EC2，然后单击实例（在该部分中）。
> - 在左侧导航窗格（向下滚动）**启动模板**。
> - 点击**创建启动模板**

image::/图片/16图片/导航到启动模版.png[导航到启动模版]


> - 启动**模板名称**：awslabsLT
> - 模板**版本说明**：Launch template version 1
> - 启动**模板内容**：
> * Amazon machine image （AMI）：Amazon Linux 2 AMI （HVM），SSD 卷类型
> * 实例类型：选择t2.micro
> - 密钥对（登录）：
> * 密钥对名称：**请勿包括在启动模板中**
> - 网络设置：
> * 子网：**请勿包括在启动模板中**
> * 安全组：下拉菜单选择**默认安全组**
> - 将其他设置保留为**默认值**。
> - 现在，点击``创建启动模板``
> - 现**已创建启动模板**。


image::/图片/16图片/启动模版成功创建.png[启动模版成功创建]


> - 单击**查看启动模板**
> - 现在已**列出启动模板**。

image::/图片/16图片/查看启动模版.png[查看启动模版]


===  创建Auto Scaling 组

==== Auto Scaling 组是 EC2 实例的**可扩展集合**。创建 Auto Scaling 组时，您需要包括实例的子网以及组必须**始终维护的实例数**等信息。

> - 转到 EC2 下的左侧菜单，然后在 AUTO SCALING 下选择。 **Auto Scaling 组**
> - 单击该``创建Auto Scaling 组``按钮。
> - 步骤 1：选择**启动模板或配置**
> * Auto Scaling 组名称：**输入 aws-ASG**
> * 启动模板：**选择awslabsLT**
> - 单击下一步按钮。
> - 步骤 2：选择**实例启动选项**
> * VPC：从列表中选择**默认VPC**。
> * 可用区和子网：为您的 Auto Scaling 实例选择**（一个或多个子网）**。
> - 单击下一步按钮。
> - 步骤 3：配置**高级选项**
> - 此页面上**不需要更改**，请单击下一步按钮。
> - 步骤 4：配置**组大小和扩展策略**
> - 在"组大小 - 可选"下
> * 所需容量：**输入 2**
> * 最小容量：**输入 2**
> * 最大容量：**输入 2**
> - 在"扩展策略 - 可选"下
> * 选择**无**
> - 在**实例缩减保护** - 可选"下
> - **无需更改**，请单击下一步按钮
> - 步骤 5：添加**通知**
> - 此页面上**不需要更改**，请单击下一步按钮。
> - 步骤 6：添加**标签**
> * **键：Name**
> * **值： ASG-EC2**
> - 单击下一步按钮。
> - 现在向下滚动并**单击``创建Auto Scaling 组``按钮**。
> - **已成功创建 aws-ASG Auto Scaling组**。

image::/图片/16图片/as组成功创建.png[as组成功创建]


> - 您将被重定向到**自动缩放组**页面，您将能够看到**自动缩放组启动了两个实例**。
> - 现在**转到 EC2 实例列表**。您将看到有**两个新的正在运行的实例**（由您的自动缩放组创建）**您可以从标签名称**中**确认**这一点，该标记名称是在**创建自动缩放组时提供的**。
> - 您已成功创建了一个策略**至少为 2 个且最多为 2 个实例**的自动扩展组。

---

=== 测试Auto Scaling 组

> - 要**测试自动扩展策略**，请转到 EC2 实例列表并**选择您的一个实例**。
> - 接下来，选择一个实例，然后单击"实例状态"，然后单击"停止实例"。
> - 单击 弹出窗口中的停止按钮以**停止您的实例**。
> - 实例停止后 （1-2 分钟后），您**可以看到已停止的实例**将**自动终止**，并且将**启动新实例**以**满足Auto Scaling 组策略条件**。
> - 下面提供了示例屏幕截图：

image::/图片/16图片/验证.png[验证]


> - 注意： 启动新实例**可能需要几分钟**时间，您可以**刷新页面以查看新实例**。

---
