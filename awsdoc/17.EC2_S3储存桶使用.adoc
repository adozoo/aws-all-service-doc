
## EC2_S3储存桶使用

=== 什么是 S3？

> - S3 代表 **简单存储服务**。
> - 它**通过 Web 服务接口** **提供对象存储**。
> - 每个对象都存储为一个包含其**元数据的文件**，并给出一个 ID 号。
> - 上传到 S3 的对象存储在名为"存储桶"的容器中，其**名称是全局唯一的**。它们在**最高级别组织** Amazon S3 命名空间。
> - Amazon S3 会在您**指定的区域**中**创建存储桶**。
> - 您可以向这些存储桶**分配权限**以**提供或限制**数据事务。
> - 应用程序使用此 ID 号访问对象。
> - 开发人员可以**通过 REST API 访问**对象。
> - S3 支持**上传对象**。
> - 它使用与 Amazon.com 用于运行其**全球电子商务网络**的**相同可扩展存储基础架构**。
> - 它专为在 AWS 上**存储数据和应用程序**的**在线备份**和**存档**而**设计**。
> - 提供的**存储类**包括：
> * 标准
> * Standard_IA即标准不频繁访问
> * Intelligent_Tiering
> * OneZone_IA
> * Glacier(冰川)
> * Deep_Archive
> * RRS，即减少冗余存储（AWS 不建议这样做）
> - 数据访问通过 S3 控制台。
> - 根据用户要求，存储的数据**可以是公共的**，**也可以是私有的**。
> - 存储的数据**可以加密**。
> - 我们可以**定义生命周期策略**，以**帮助实现数据传输**、**保留**和**删除**的**自动化**。
> - **Amazon Athena** 可用于"查询"S3 数据。

=== 架构图

image::/图片/17图片/架构图.png[架构图]

== 实验步骤

=== 创建 S3 存储桶

> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域。
> - 顶部菜单**导航到 S3**

image::/图片/09图片/导航到S3.png[导航到S3]

> - 在 S3 页面上，单击``创建存储桶``并**填写存储桶详细信息**。
> - 桶名称：输入``mys3bucket-test-abcd``
> * 注意： S3 存储桶名称是**全局唯一**的，请**选择一个可用的名称**。
> - AWS 区域：选择美国东部（弗吉尼亚北部）美国东部-1
> - 对于对象所有权：选择**ACL 已启用**
> * 对象所有权选项：选择**对象编写者**
> - 注意：请选择对象编写者，否则将**不允许编辑存储桶 ACL**。
> - 对于此存储桶的“阻止公有访问”设置部分
> * **取消选中**"阻止所有公共访问"选项，然后**选中确认**选项。
> - 将**其他设置保留**为默认值。
> - **创建存储桶按钮**
> - S3 **存储桶已创建**。

image::/图片/17图片/成功创建存储桶.png[成功创建存储桶]


=== 将对象上传到 S3 存储桶


> - **单击**您的存储桶名称。
> - 在对象中，您可以看到**以下消息**
> * 此存储桶中**没有任何对象**。

image::/图片/17图片/没有对象.png[没有对象]


> - 您可以从本地计算机**上传任何图像**
> - 将文件上传到我们的 S3 存储桶
> * 点击**上传**按钮。
> * 点击**添加文件**按钮。
> * 浏览您的本地图像**并选择它**
> * 单击上传按钮**上传**。
> - 您可以从屏幕顶部的传输面板中**查看上传进度**。
> - 上传文件后，它将**显示在存储桶中**。

image::/图片/17图片/上传图片成功.png[上传图片成功]


=== 更改存储桶权限

==== 更改存储桶的权限以使其映像公开可用。

> - 在"对象"下，单击**上传的图像名称**，您将看到**图像详细信息**，如**所有者，大小，链接**等。
> - URL 将列在"对象 URL"下

image::/图片/17图片/图像URL.png[图像URL]

> - 在新选项卡中**打开图像链接**。
> * 您将看到一条 AccessDenied 消息，这意味着该**对象不可公开访问**。

image::/图片/17图片/拒绝访问.png[拒绝访问]


> - 然后**导航到"权限"选项卡**。
> - 现在点击右上角的**编辑**按钮。
> * 注意：如果编辑按钮被禁用，请将**存储桶所有权更改为启用 ACL**，然后选择**对象编写者作为所有者**。
> - 所有人（公共访问权限）：**选中"对象"的"读取"复选框**。
> - 现在在下面滚动一点，**选中``我了解这些变化对此对象的影响``的复选框**。

image::/图片/17图片/修改ACL.png[修改ACL]


> - 现在滚动到底部，然后**单击``保存更改``按钮**
> - 现在再次在新选项卡中**打开图像对象URL**，您将在浏览器中**看到您上传的图像**。

image::/图片/17图片/第一张图.png[第一张图]

---

=== 创建存储桶策略（可选）


> - 在上一步中，您仅授予了**对特定对象**的**读取访问权限**。
> - 如果您希望公开存储桶中的所有对象，可以通过**创建存储桶策略**来实现此目的。
> - 通过单击您的存储桶名称转到存储桶。
> - 单击``权限``选项卡，然后**配置以下内容**
> * 向下滚动到**存储桶策略**，单击右侧的**编辑**按钮。
> * 此时将显示一个空白的**存储桶策略编辑器**。
> * 将存储桶的 ARN 复制到**剪贴板**。
> * 例如``arn:aws:s3:::mys3bucket-test-abcd``
> - 复制下方**整个策略**，将其粘贴到存储桶策略中，
> - 下面 JSON 中的 Resource **改为自己的存储桶ARN**

```json
  {
     "Id": "Policy1",
     "Version": "2012-10-17",
     "Statement": [
        {
           "Sid": "Stmt1",
           "Action": [
              "s3:GetObject"
           ],
           "Effect": "Allow",
           "Resource": "replace-this-string-from-your-bucket-arn/*",
           "Principal": "*"
        }
     ]
  }
```

image::/图片/17图片/存储桶策略.png[存储桶策略]

> - 点击``保存更改``按钮。

---

=== 测试公共访问

> - 上传**其他图片**
> * 点击**上传**按钮。
> * 点击**添加文件**按钮。
> * 浏览您的本地图像并选择它
> * 单击上传按钮**上传**。
> - 图像上传成功后，单击对象名称（图像名称），**复制图像URL**并**在浏览器中打开**。
> * 例``https://mys3bucket-test-abcd.s3.amazonaws.com/93706616_p0.jpg``

image::/图片/17图片/第二张图.png[第二张图]


> - 您**可以看到图像** **已成功加载且可公开访问**。

---
