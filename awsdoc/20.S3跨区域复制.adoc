
## S3跨区域复制

=== 什么是S3跨区域复制？

> - **跨区域复制**是一种将数据从一个存储桶复制到另一个可能位于不同区域的存储桶的功能。
> - 它提供跨**存储桶的对象的异步复制**。假设 X 是源存储桶，Y 是目标存储桶。如果 X 想要将其对象复制到 Y 存储桶，则**不会立即复制**对象。
>
> - 跨区域复制需要**记住的几点**
> * **创建两个存储桶**：在 AWS 管理控制台中创建两个存储桶，其中一个存储桶是源存储桶，另一个是目标存储桶。
> * **启用版本控制**：只有在两个桶的版本控制都启用时，才能实现跨区域复制。
> * **Amazon S3 使用 SSL 对跨 AWS 区域传输的数据进行加密**：它还可以在数据穿越不同区域时提供安全性。
> * **已上传的对象不会被复制**：如果bucket中已经存在任何一种数据，那么执行跨区域复制时不会复制该数据**(2022年3月时间点可以实现)**。
>
> - **跨区域复制的用例**
> - **合规性要求**
> * 默认情况下，Amazon S3 将数据存储在不同的地理区域或可用区以具有数据的可用性。有时可能存在您希望将数据存储在某个特定区域的合规性要求。跨区域复制允许您在某些特定区域复制数据以满足需求。
> - **最小化延迟**
> * 假设您的客户位于两个地理区域。为了最大限度地减少延迟，您需要在地理上更接近您的用户的 AWS 区域中维护数据副本。
> - **维护不同所有权下的对象副本**：无论谁拥有源存储桶，您都可以告诉 Amazon S3 将所有权更改为拥有目标存储桶的 AWS 账户用户。这称为所有者覆盖选项。

=== 架构图

image::/图片/20图片/架构图.png[架构图]

== 实验步骤

=== 创建源存储桶

> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域。
> - 顶部菜单**导航到 S3**

image::/图片/09图片/导航到S3.png[导航到S3]

> - 在 S3 页面上，单击``创建存储桶``并**填写存储桶详细信息**。
> - 桶名称：输入``awssource1-test``（源存储桶）
> * 注意： S3 存储桶名称是**全局唯一**的，请**选择一个可用的名称**。
> - AWS 区域：选择美国东部（弗吉尼亚北部）美国东部-1
> - 对于对象所有权：选择**ACL 已禁用(推荐)**
> - 对于此存储桶的“阻止公有访问”设置部分
> * **取消选中**"阻止所有公共访问"选项，然后**选中确认**选项。
> - 在存储桶**"版本控制选项**"中，选中**"启用选项**"。
> - 将**其他设置保留**为默认值。
> - **创建存储桶按钮**
> - S3 **源存储桶已创建**。

=== 创建目标存储桶

> - 在 S3 页面上，单击``创建存储桶``并**填写存储桶详细信息**。
> - 桶名称：输入``awstarget-test``（目标存储桶）
> * 注意： S3 存储桶名称是**全局唯一**的，请**选择一个可用的名称**。
> - AWS 区域：选择美国东部（俄亥俄）美国东部-2
> - 对于对象所有权：选择**ACL 已禁用(推荐)**
> - 对于此存储桶的“阻止公有访问”设置部分
> * **取消选中**"阻止所有公共访问"选项，然后**选中确认**选项。
> - 在存储桶**"版本控制选项**"中，选中**"启用选项**"。
> - 将**其他设置保留**为默认值。
> - **创建存储桶按钮**
> - S3 **目标存储桶已创建**。

image::/图片/20图片/源目标桶.png[源目标桶]

=== 在源存储桶中启用复制并**添加规则**

> - 现在转到源存储桶，然后单击**管理**。向下滚动并**选择"创建复制规则"**
> - 输入您的规则**名称**，并将状态**保持为"已启用"**。

image::/图片/20图片/复制规则.png[复制规则]

> - 选择**规则范围** ：**此规则应用到存储桶中的所有对象**
> - 在目标下，选择``在此账户中选择一个存储桶``，然后单击**浏览 S3**。
> - 选择之前创建的**目标存储桶**，然后单击**选择路径**。

image::/图片/20图片/选择路径.png[选择路径]

> - 在 IAM 角色下，选择**从现有 IAM 角色中选择**
> - **创建新角色**

image::/图片/20图片/IAM.png[IAM]

> - 在**加密**下，选择``复制已使用 AWS KMS 加密的对象``，然后选择**别名 aws/s3**。

image::/图片/20图片/加密.png[加密]

> - 在**"目标存储类"**下，选择**"更改已复制对象的存储类"**，然后选择**"单区 – IA"**。

image::/图片/20图片/存储类.png[存储类]

> - 将其他内容保留为**默认值**。然后**单击保存**。
> - **是否复制现有对象**？
> - 选择**"否，不复制现有对象"**。

image::/图片/20图片/规则成功.png[规则成功]

---

=== 测试

> - 现在导航到**源存储桶**，然后单击**添加文件**，在源存储桶中**上传对象**（.txt或.png）。点击上传。
> - 导航到您的**目标存储桶**以**查看复制**。复制最多**可能需要 3-5 分钟**。

image::/图片/20图片/目标桶内容.png[目标桶内容]

> - 现在，您已在 S3 存储桶中**成功配置了跨区域复制**

---
