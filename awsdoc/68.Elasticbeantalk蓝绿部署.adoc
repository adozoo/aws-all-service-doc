
## Elasticbeantalk蓝绿部署

=== AWS Elastic Beanstalk

> - AWS Elastic Beanstalk 是 Amazon 提供的**平台即服务 （PaaS）**，用于**部署和扩展 Web 应用程序**
> - 它允许我们使用广泛的**应用程序平台**。
> - 它还使我们能够**拥有各种应用程序部署选项**。
> - 它使开发人员能够**专注于开发**，而不是**花时间管理和配置服务器**。
> - 它使我们**能够根据应用程序的特定需求**自动**扩展和缩减**应用程序。

=== 使用 Elastic Beanstalk 的蓝/绿部署

> - AWS Elastic Beanstalk 在**当前生产环境中执行正常部署**。因此，在**更新完成之前**，应用程序将对**用户不可用**。
> - 通过**执行蓝/绿部署**可以**避免此停机时间**。
> - 蓝/绿部署用于将**应用程序从一个版本更新到另一个版本**，而**无需停机**。
> - 蓝色环境是**承载实时流量的现有生产环境**。
> - 绿色环境是**运行不同**或**更新版本**的应用程序的相同并行**新环境**。
> - 部署**蓝/绿环境**，以便您可以将新版本**部署到单独的环境**。
> - 部署完成后，我们只需通过**交换其 CNAME 或使用 Route 53 缓慢转移流量百分比**（不包括在本练习中）来将**流量从蓝色环境路由到绿色环境**。
> - **路由完成**后，如果您在**绿色环境中遇到任何问题**，Elastic BeanStalk 为我们**提供了一个选项**，可以**轻松回滚到蓝色环境**。

=== 优势

> - 在**更新环境**和**交换时**实现**零停机时间**。
> - 如果您在**新环境中遇到任何问题**，很**容易回滚到旧版本**。

image::/图片/68图片/EB部署方式.png[EB部署方式]

=== 架构图

image::/图片/68图片/架构图.png[架构图]

== 实验步骤

=== 创建 Elastic Beanstalk 应用程序

> - 确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域。
> - 通过单击顶部的服务菜单导航到 **Elastic Beanstalk**
> - 在 Elastic Beanstalk 中，您将看到一个``欢迎界面``。您需要做的就是单击**``创建应用程序``**按钮。
> - 在此页面上，我们将输入简单的详细信息以使应用程序启动并运行：
> * 应用程序名称：输入**``Sample_Application``**
> * 将应用程序标签保留为**默认值**。
> * 在"平台"下：选择**"PHP"**
> * 将其他设置**保留为默认值**。
> * 单击**创建应用程序**按钮。AWS 将开始工作为您**创建环境**。
> * 注意：此过程通常需要**大约 10 到 15 分钟才能完成**。

---

=== 创造 Elastic Beanstalk 蓝色环境

> - 在左侧面板上，单击**"应用程序"**选项。
> - 单击**"应用程序名称"**（**Sample_Application**）以**查看存在的环境**。
> - 创建**``Sample_Application``**后。它具有**默认环境**。
> - 您需要为**Sample_Application**创建一个新环境，即**蓝色环境**
> - 为此，请单击**"创建新环境"**按钮。
> - 在**"选择环境层"**页上，选择**``Web 服务器环境``**，然后单击**"选择"**。
> - 在**"创建 Web 服务器环境"**页上，将环境名称作为**``awslabs-blue-environment``**提供
> - 注意：环境名称应该是**唯一**的，如果在提供名称时**遇到任何错误**，请**提供其他名称**。
> - 在"平台"中，在**"托管平台"**下，从下拉列表中选择**"PHP"**。

image::/图片/68图片/php.png[php]


> - 在**"应用程序代码"**下，选择**"示例应用程序"**，然后单击**创建环境**。
> - 环境将需要 5 到 10 分钟来**预配资源**。在环境设置完成之前，请**耐心等待**。
> - 同时，您可以看到**正在逐个预配的资源**
> - 预配**``awslabs-blue``**环境后，你将获得一个页面，其中**"运行状况正常"**，并带有该**环境的 URL**。
> - 单击**环境 URL**，将**导航到 PHP 应用程序页面**，如下所示：

image::/图片/68图片/蓝色环境.png[蓝色环境]

---

=== 创建 Elastic Beanstalk 绿色环境


> - 在左侧面板上，单击**"应用程序"**选项。
> - 单击**"应用程序名称"**（**Sample_Application**）以查看**存在的环境**。
> - 现在将有**两个环境**。

image::/图片/68图片/两个环境.png[两个环境]

> - 您需要为**``Sample_Application``**创建一个新环境，即**绿色环境**
> - 为此，请单击**"创建新环境"**按钮。
> - 在**"选择环境层"**页上，选择**Web 服务器环境**，然后单击**"选择"**。
> - 在"创建 Web 服务器环境"页上，将环境名称作为**``awslabs-green-environment``**提供
> - 注意： 环境名称应该是唯一的，如果在提供名称时**遇到任何错误**，请**提供其他名称**。
> - 在平台中，在"托管平台"下，从下拉列表中选择**"Node.Js"**。

image::/图片/68图片/nodejs.png[nodejs]

> - 在**"应用程序代码"**下，选择**"示例应用程序"**，然后单击**创建环境**。
> - 环境将需要 5 到 10 分钟来预配资源。在预配环境之前，请**耐心等待**。同时，您可以看到正在逐个**预配的资源**。
> - 设置好**``awslabs-green-env``**后，您将获得一个页面，其中**"运行状况正常"**，并带有环境的 URL。
> - 单击**环境 URL**，将**导航到 Node.js 应用程序页面**，如下所示：

image::/图片/68图片/绿色环境.png[绿色环境]

---

=== 将 URL 从蓝色交换为绿色

> - 现在我们有**两个环境**，即使用PHP**``awslabs_blue_environment``**和使用Node**``awslabs_green_environment``**
> - 接下来，我们**需要交换 URL**。
> - 在**``awslabs_green_env``**的 Elastic Beanstalk 应用程序控制面板中，单击**操作**，然后选择**交换环境 URL**。

image::/图片/68图片/交换环境url.png[交换环境url]

> - 从"选择要交换的环境"部分的**下拉列表中选择**"环境名称"为**``awslabs-blue-environment``**，然后单击**"交换"**。

image::/图片/68图片/交换中.png[交换中]

> - 交换将需要几秒钟才能完成。您将在**"最近事件"**下看到**"成功完成"**状态。

image::/图片/68图片/交换成功.png[交换成功]

> - 交换完成后，请注意，**``awslabs_green_env``**的 URL 将替换为**``awslabs_blue_environment``**的 URL。

image::/图片/68图片/交换后url查看.png[交换后url查看]

> - 现在，单击 URL（这是awslabs_blue_environment的 URL），然后注意到这是**``awslabs_green_env``**的内容。

image::/图片/68图片/验证交换.png[验证交换]

> - 注意：在交换URL后，请**等待2-5分钟**，如果新页面内容**未显示**，请**清除浏览器缓存**或尝试从**其他浏览器访问URL**。


---



