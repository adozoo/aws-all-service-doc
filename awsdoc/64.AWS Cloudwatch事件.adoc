
## AWS Cloudwatch事件

=== 架构图

image::/图片/64图片/架构图.png[架构图]

== 实验步骤

=== 启动 EC2 实例

> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域
> - 通过菜单**导航到 EC2**,单击**启动新实例**。

==== (1)控制台启动实例

image::/图片/07图片/控制台2.png[控制台启动实例]

==== (2)选择系统镜像

image::/图片/07图片/控制台3.png[选择系统镜像]

==== (3)选择实例类型

image::/图片/07图片/配置1.png[选择实例类型]

==== (4)配置实例

> - 实例的数量：**选择 1**
> - 将其余设置**保留为默认值**，然后单击**下一步按钮**。

==== (5)添加存储

image::/图片/07图片/配置2.png[添加存储]

==== (6)添加标签

image::/图片/07图片/配置3.png[添加标签]

==== (7) 配置安全组

> - 添加 SSH：

----
  . 选择类型： 选择 SSH
  . 协议：TCP
  . 端口范围：22
  . 源：选择"任何位置"
----

> - 点击下一步 `审核和启动`

==== (8) 审核启动

> - **检查**所有选定的设置，**无误点击启动**
> - 选择现有密钥对，确认并单击**启动实例**

image::/图片/07图片/现有密钥.png[现有密钥]

---

=== 创建 SNS 主题

> - 确保您位于**弗吉尼亚北部**区域。
> - 通过菜单导航到**"SNS"**。
> - 单击左侧面板中的**主题**，然后单击**创建主题**。
> - 在**"详细信息"**下：
> * 类型：选择**标准**
> * 名称 ： 输入**``MyServerMonitor``**
> * 显示名称 ： 输入**``MyServerMonitor``**
> - 将其他选项**保留为默认值**，然后单击**创建主题**。
> - 现已**创建一个 SNS 主题**。

image::/图片/63图片/sns主题创建完成.png[sns主题创建完成]

---

=== 订阅 SNS 主题

> - 创建 SNS 主题后，单击 SNS 主题**"MyServerMonitor"**。
> - 单击**创建订阅**。
> - 在**"详细信息"**下：
> * 协议 ：选择**电子邮件**
> * 终端节点 ：输入**您的电子邮件地址**
> * 注意： 请确保**提供正确的电子邮件地址**，因为这是将传递您的**通知的地方**。
> - 您的电子邮件地址将**收到订阅确认**

image::/图片/63图片/sns邮件.png[sns邮件]

> - 单击**"确认订阅"**。

image::/图片/63图片/确认sns.png[确认sns]


> - 您的电子邮件地址现**已订阅 SNS 主题**MyServerMonitor。

---

=== 创建CloudWatch事件

==== 使用 CloudWatch 事件，我们将通过停止和启动 EC2 实例来触发 SNS 通知。

> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域
> - 顶部菜单**导航到 CloudWatch**,单击**事件下规则页面中的的创建规则**按钮
> - 步骤 1：**创建规则页面**中，
> * 在**"事件源"**下：
> ** 选择**事件模式**
> ** 服务名称：选择 **``EC2``**
> ** 事件类型：选择 **``EC2 Instance State-change Notification``**
> ** 本节中**不需要其他更改**。
> * 在**"目标"**（右侧）下：
> ** 单击**添加目标**。
> ** 从目标下拉列表中选择**SNS 主题**
> ** 主题：下拉菜单中选择**``MyServerMonitor``**。
> * 单击**"配置详细信息"**按钮。
> - 步骤 2：**配置规则详细信息**页面中。在规则定义下：
> * 名称 ： 输入**``MyEC2StateChangeEvent``**
> * 描述 ： 输入**``MyEC2StateChangeEvent``**
> * 状态 ： **选中（默认）**
> * 单击**"创建规则"**按钮。
> - 现在，您已**成功创建了 CloudWatch 事件**。
> - 事件**如下所示**

image::/图片/64图片/事件规则.png[事件规则]

> - 现在，**每次停止或启动 EC2 服务器**时，都会**向 SNS 订阅中配置的电子邮件地址发送电子邮件通知**。

---

=== 测试CloudWatch事件

> - 导航到 AWS 管理控制台中的 EC2 页面。
> - 单击左侧面板中的**实例**。
> - **选择创建的 EC2 实例**。单击**实例状态**，然后单击**停止实例**。
> - 返回您的**电子邮件地址**。您应该**已经收到了一些邮件**。

image::/图片/64图片/正在停止.png[正在停止]

image::/图片/64图片/已停止.png[已停止]


> - 由于 MyEC2 服务器**状态更改**，已发送**两封 CloudWatch 事件电子邮件**。（正在停止和已停止）。
> - 导航回 EC2 页面并**启动 EC2 实例**。您将收到另外**两封有关状态更改的电子邮件**。（挂起和正在运行）。

image::/图片/64图片/启动.png[启动]

> - 您已成功**触发CloudWatch事件通知**。
> - 您还可以为**其他 AWS 资源创建 Cloudwatch 事件通知**。

---
