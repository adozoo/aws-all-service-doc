
## API 网关中启用CloudWatch Logs

=== Amazon API Gateway

> - Amazon API Gateway 是一项**完全托管的服务**，使开发人员可以**轻松创建、发布、维护、监控和保护任何规模的 API**。
> - API 充当应用程序从**后端服务访问数据**、**业务逻辑**或**功能的前门**。
> - API 网关可处理**接受和处理**多达**数十万个并发 API 调用**所涉及的**所有任务**，包括**流量管理、CORS 支持、授权和访问控制、限制、监控和 API 版本管理**。
> - 使用 API 网关，您可以创建 **RESTful API 和 WebSocket API**，以支持实时**双向通信应用程序**。API 网关支持**容器化**和**无服务器**工作负载以及 Web 应用程序。

=== 架构图

image::/图片/71图片/架构图.png[架构图]

== 实验步骤

=== 创建接口

> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域
> - 顶部菜单**导航到 ``API Gateway``**
> - 向下滚动找到**REST API**并单击**"构建"**按钮。

image::/图片/70图片/1.png[1]

> - 忽略弹出窗口**"创建您的第一个 API"**，然后选择**协议为 REST**。
> - 然后选择"设置"下的**"新建 API "**。输入 API 名称为**``awslab API``**，然后单击**"创建 API"**
> - 单击左侧面板中的**API**，**查看您创建的 awslab API**

image::/图片/70图片/2.png[2]

> - 注意： 如果出现任何弹出窗口，请**忽略它们**。

---

=== 创建 IAM 角色

> - 导航到``IAM``
> - 在**左侧菜单**中，单击``角色`` 。单击``创建角色``该按钮以**创建新的 IAM 角色**。
> - 在创建角色部分，为角色选择**可信实体类型**：
> * **AWS 服务**
> * **使用案例:API Gateway**

image::/图片/71图片/iam.png[iam]

> - 单击**下一步**
> - 添加权限：将权限**保留为默认值**。
> - 单击**下一步**
> - 角色名称：输入 **CloudWatchLogs**
> - 您**已成功**按名称 CloudWatchLogs 创建了一个 IAM 角色。

==== 单击创建的角色，并**记下角色的 ARN 以供将来使用**。

---


=== 创建资源

> - 创建 API 后，单击**``awslab API``**，然后单击**操作**按钮
> - 在操作中选择**创建资源**选项。
> * 资源名：输入**``awslabs``**
> - 输入资源名称后，单击**"创建资源"**按钮

---


=== 创建方法

> - 创建资源后，单击**"操作"**，然后选择**创建方法**。从下拉列表中选择**``POST``**，然后单击**``√``**。
> - 选择集成类型为**AWS 服务**
> - 输入以下详细信息：
> * 选择 AWS 区域：**``us-east-1``**
> * 选择 AWS 服务：**``CloudWatch Logs``**
> * HTTP 方法： **``POST``**
> * 操作： 输入**``GetLogsEvent``**
> * 执行角色：复制并**粘贴我们之前记下的角色 ARN**。
> * 将**其他选项保留为默认值**，然后单击**保存**。

image::/图片/71图片/aws服务.png[aws服务]

> - 创建后，您将**看到此页面**。

image::/图片/71图片/完成.png[完成]


---

=== 部署接口

> - 成功**创建资源和方法**后，即可**部署 API**。
> - 单击操作选择**部署API**。
> - 将下拉列表中的**"部署阶段"**选择为**"新阶段"**。
> - 输入阶段名称 ： **``TestingAPI``**
> - 单击**部署**。
> - 导航到**"阶段"**，然后单击**"TestingAPI"**。
> - 部署 API 后，单击**日志/追踪选项**
> - 启用 CloudWatch 日志：**``选中``**
> - 记录完整的请求/响应数据：**``选中``**
> - 点击**保存更改**
> * 注意： 您可能会看到**以下错误**：**``CloudWatch Logs role ARN must be set in account settings to enable logging``**。
> * 要**解决此问题**，请**复制我们的 IAM 角色的 ARN 并**将其**粘贴到 Cloudwatch 日志角色 ARN 中**（在左侧边栏中的**"设置"**中），然后单击**保存**

image::/图片/71图片/设置.png[设置]

> - 导航到** CloudWatch Logs 下的日志组**以**查看日志**。

image::/图片/71图片/验证.png[验证]


> - 您已成功为 API 网关**创建CloudWatch Logs**。每当**流量通过 API 网关时**，都会**生成流**。


---




