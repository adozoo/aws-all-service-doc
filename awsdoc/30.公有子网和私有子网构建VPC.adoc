
## 公有子网和私有子网构建VPC

=== 什么是VPC？

> - VPC 代表 **虚拟私有云**。
> - 它是 AWS 云中**自定义的虚拟网络**。
> - 用户可以在逻辑上**创建其个人网络**，**设计和实施**将在 AWS 云中运行的**独立网络**。
> - 主要组件包括：**子网、IP 地址、NAT 设备（实例和网关）、路由表、Internet 和虚拟私有网关、访问控制列表、安全组、VPC 终端节点**。
> - 子网是 VPC IP 地址范围的**一个段**，我们可以**在其中启动 EC2 实例、RDS 和其他 AWS 资源**。
> - 子网进一步分类为**公有和私有**。
> - **公有子网保存可从互联网访问的资源**。
> - 公有子网中实例的**常见属性包括**：
> - 附加到 EC2 实例的弹性 IP （EIP） 地址或公有 IP 地址。
> - 连接到专有网络的 IGW。
> - 子网必须具有目标为互联网网关 （IGW） 0.0.0.0/0 的路由表条目。
> - **公有子网与路由表相关联**，该路由表使用互联网网关将子网流量**定向到互联网**。
> - **私有子网保存可从 VPC 网络内访问的资源**。
> - 多个子网可以与单个路由表关联。但是，**单个子网不能与多个路由表关联**。
> - 路由表包含**规则集**，这些规则称为用于确定流量**定向位置的路由**。
> - VPC 中的每个子网都**链接到路由表**。
> - 主路由表或主路由表是 VPC 自动附带的路由表。它们控制未与任何其他路由表**显式关联的所有子网的路由**。
> - **无法删除默认路由表**。
> - 自定义路由表是您为 VPC 创建的路由表，您可以**根据需要添加路由**。
> - **不需要时可以删除**自定义路由表。
> - 互联网网关 （IGW） 是帮助 VPC 连接到互联网的**虚拟路由器**。
> - 默认情况下，在 VPC 中启动的实例无法与**公网通信**。要启用**公网访问**，需要将**公网网关附加到专有网络**。
> - 公有子网通过路由表连接到 IGW，以便通过**互联网进行访问**。
> - 互联网网关是**水平可扩展的，高度可用和冗余的**。
> - EIP，弹性 IP 地址是 AWS 用于管理其动态云计算服务的**静态 IPv4 地址**。
> - 它与 AWS 账户相关联，如果发生实例故障，您可以使用它来屏蔽，即，如果服务器出现故障，我们可以将此 IP 地址映射到另一台服务器并继续移动而**不会出现任何问题**。
> - NAT 设备可以是**驻留在公有子网中的实例/网关**（向其分配了 EIP）。
> - NAT 设备**可帮助私有子网中的实例与互联网交互**。
> - 访问控制列表 （ACL） 是一个**可选的安全层**，**充当防火墙**，用于**控制进出子网的网络流量**。
> - 使用 ACL 定义规则，用于**允许或拒绝端口/IP 地址上的网络流量**。

=== 架构图

image::/图片/30图片/架构图.jpeg[架构图]

== 实验步骤

=== 创建新的VPC

> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域
> - 顶部菜单**导航到 VPC**
> - 单击左侧菜单中的**您的 VPC**
> - 在这里，您可以**看到所有 VPC 的列表**，无需对现有和默认 VPC **执行任何操作**，我们将**创建一个新的 VPC**。
> - 单击**``创建 VPC``**按钮。
> * 名称标签： **输入用于向您的 VPC 标识的 VPC 名称**。例如：MyVPC
> * IPv4 CIDR 块： 输入 **10.0.0.0/16**
> * IPv6 CIDR 块： 无需更改此设置，请确保选中**"无 IPv6 CIDR 块"**
> * 租期： 无需更改此设置，请确保**选中"默认"**。
> - 现在单击**``创建 VPC``**按钮

image::/图片/30图片/vpc.png[vpc]

> - 创建VPC后，它将显示**详细信息**，**如下所示**：

image::/图片/30图片/vpcok.png[vpcok]

---

=== 创建子网

> - 我们将分别在 **us-east-1a** 和 **us-east-1b** 可用区中**创建一个公有子网**和**一个私有子网**，如下所示：
> * 对于公有子网，单击左侧菜单中的子网，然后单击**创建子网**。
> ** VPC ID ：从您之前创建的列表中选择 **MyVPC**。
> ** 子网名称 ：输入名称 **MyPublicSubnet**
> ** 可用区 ： 选择 **us-east-1a**
> ** IPv4 网段：输入范围 **10.0.1.0/24**
> ** 单击**"创建子网"**。
> * 对于私有子网，再次单击**"创建子网"**。
> ** VPC ID ：从您之前创建的列表中选择 **MyVPC**。
> ** 子网名称 ：输入名称 **MyPrivateSubnet**
> ** 可用区 ： 选择 **us-east-1b**
> ** IPv4网段：输入范围**10.0.2.0/24**
> ** 单击**"创建子网"**。

image::/图片/30图片/subnetok.png[subnetok]

---

=== 创建和配置互联网网关

> - 单击左侧菜单中的**互联网网**关，然后单击**创建互联网网关**。
> * 名称标签：**MyInternetGateway**。
> * 单击**创建互联网网关**。
> - 从列表中**选择您创建的互联网网关**
> * 单击**"操作"**。
> * 单击**附加到VPC**
> * 从列表中**选择您创建的MyVPC**，然后单击**连接互联网网关**。

image::/图片/30图片/igw.png[igw]

---

=== 创建路由表

> - 从左侧菜单中**转到路由表**，然后单击**创建路由表**。
> * 名称： 输入**"PublicRouteTable"**。
> * VPC： 从列表中选择**"MyVPC"**。
> * 单击**创建路由表**。
> - 重复相同的步骤，为私有子网**创建路由表**。
> * 名称： 输入 **PrivateRouteTable**。
> * VPC： 从列表中选择**"MyVPC"**。
> * 单击**创建路由表**。

image::/图片/30图片/routetable.png[routetable]

> - 现在，将子网**关联到路由表**。
> - 单击 **PublicRouteTable**，单击**``操作``**。
> * 然后转到**"子网关联"**选项卡
> * 从列表中选择**"MyPublicSubnet"**。
> * 单击**保存关联**。
> - 单击 **PrivateRouteTable**，单击**``操作``**。
> * 然后转到**"子网关联"**选项卡
> * 从列表中选择 **MyPrivateSubnet**。
> * 单击**保存关联**。
> - 确保**不要将任何子网与主路由表关联**。
> - PublicRouteTable：添加允许公网流量**流向 VPC 的路由**。
> - 选择**"PublicRouteTable"**。
> - 转到"路由"选项卡，然后单击**``编辑路由``**按钮。
> - 然后单击**``添加路由``**按钮。
> - 指定以下值：
> * 目标：输入 **0.0.0.0/0**
> * 目标：从下拉菜单中选择互联网网关，选择**``MyInternetGateway``**。
> * 点击**保存更改**。

image::/图片/30图片/route.png[route]


---
