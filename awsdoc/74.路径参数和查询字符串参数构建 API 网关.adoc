
## 路径参数和查询字符串参数构建 API 网关

=== 架构图

image::/图片/74图片/架构图.png[架构图]


== 实验步骤


=== 创建 Lambda 函数

> - 确保您位于**美国东部（弗吉尼亚北部）区域**。
> - 转到菜单，然后单击 **Lambda**。

image::/图片/09图片/导航到Lambda.png[导航到Lambda]

> - 单击**创建函数**该按钮。
> - 选择**``从头开始创建``**
> - 函数名称：输入 **``awslabsAPI``**
> - 运行时：**``Python 3.9``**
> - 角色：在权限部分中，单击**"更改默认执行角色"**，然后单击**"从 AWS 策略模板创建新角色"**。
> - 输入角色名称为**``awslabsAPI_role``**，选择策略模板为**``基本 Lambda@Edge 权限（适用于 CloudFront 触发器）``**
> * 点击**创建函数**该按钮。
> - **成功创建 Lambda 函数后**，它将类似于下面的**屏幕截图**：

image::/图片/72图片/lambda.png[lambda]

> - 函数代码 ：将现有代码**替换为以下内容**，然后单击**"部署"**。

```py
  import json
  def lambda_handler(event, context):
      #Path parameter passed to Lambda function
      servername = event["params"]["path"]["servername"]
      #Query string parameter passed to Lambda function
      Email_id = event['params']['querystring']['emailid']
      return {
          "Path Parameter" : servername,
          "Query string Parameter" : Email_id
      }
```

---


=== 创建 API

> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域
> - 顶部菜单**导航到 ``API Gateway``**
> - 向下滚动找到**REST API**并单击**"构建"**按钮。

image::/图片/70图片/1.png[1]

> - 忽略弹出窗口**"创建您的第一个 API"**，然后选择**协议为 REST**。
> - 然后选择"设置"下的**"新建 API "**。输入 API 名称为**``awslab API``**，然后单击**"创建 API"**
> - 单击左侧面板中的**API**，**查看您创建的 awslab API**

image::/图片/70图片/2.png[2]

> - 注意： 如果出现任何弹出窗口，请**忽略它们**。

---

=== 使用路径参数创建资源

> - 创建 API 后，单击**``awslab API``**，然后单击**操作**按钮
> - 在操作中选择**创建资源**选项。
> * 资源名：输入**``servername``**
> * 资源路径：输入**``{servername}``**
> * 注意：资源路径应**放在花括号 { } 内**
> - 单击**"创建资源"**按钮

---

=== 创建方法

> - 创建资源后，单击**"操作"**，然后选择**创建方法**。从下拉列表中选择**``GET``**，然后单击**``√``**。
> - 选择集成类型为**Lambda 函数**
> - 输入以下**详细信息**：
> * Lambda 区域：**``us-east-1``**
> * Lambda 函数：**``awslabsAPI``**
> * 将**其他选项保留为默认值**，然后单击**保存**。

image::/图片/74图片/方法.png[方法]

> - 创建后，您将**看到此页面**。

image::/图片/74图片/创建完成.png[创建完成]


---

=== 添加查询字符串参数

> - 单击**GET**方法页面中的**"方法请求"**链接。
> - 在**"设置"**下：
> * 请求验证程序：**单击✏️（铅笔）按钮**。
> * 选择**``验证正文、查询字符串参数和标头``**选项
> * 点击**``√``**图标。

image::/图片/74图片/方法请求.png[方法请求]

> - 在**URL 查询字符串参数**下：
> * 单击**添加查询字符串**链接。
> * 名称：输入**``emailid``**，然后单击**``√``**
> * 选中**必需**复选框

image::/图片/74图片/查询字符串参数.png[查询字符串参数]

> - 现在**返回上一页面**
> - 单击 GET 方法页中的**"集成请求"**链接。
> - 向下滚动到底部，然后选择**映射模板**
> - 请求正文传递：选择**``当未定义模板时 (推荐)``**
> - 点击**添加映射模板**
> - 在文本框中输入**``application/json``**，然后单击**``√``**。
> - 再次向下滚动到**页面底部**。
> - 生成模板：从列表中选择**``方法请求传递``**。
> - 单击**保存**按钮。
> * 注意：单击保存按钮**不会将您重定向到任何页面**，但请**确保单击保存按钮**。
> - 现在**返回上一页面**。

---

=== 部署 API

> - 成功**创建资源和方法**后，即可**部署 API**。
> - 单击操作选择**部署API**。
> - 将下拉列表中的**"部署阶段"**选择为**"新阶段"**。
> - 输入阶段名称 ： **``TestingAPI``**
> - 输入描述 ： **``Testing environment for my awslabsAPI``**
> - 单击**部署**。
> - 部署 API 后，导航到**"阶段"**，然后单击**"TestingAPI"**。
> - 您将能够**看到以下内容**：

image::/图片/74图片/阶段.png[阶段]

> - 现在单击阶段的** GET 方法**
> - 单击**调用 URL链接**以**发出GET请求**。
> - 现在，将**``{servername}``**替换为**``Production``**，然后添加**``?emailid=自己的邮箱地址``**
> - 您将收到**来自 API 的 GET 响应**。下面是一个**示例截图**：

image::/图片/74图片/验证.png[验证]

---


