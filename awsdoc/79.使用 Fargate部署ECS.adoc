
## 使用 Fargate部署ECS

=== 什么是 Docker？

> - Docker 是**一种工具**，旨在**使用容器**更**轻松地创建**、**部署和运行应用程序**。
> - 容器允许**开发人员将应用程序**与**它需要的所有部分（如库和其他依赖项）打包在一起**，并将其**部署为一个包**。
> - 通过这样做，应用程序将在**任何其他 Linux 计算机上无障碍运行**，而**不管该计算机可能具有的任何自定义设置**，这些**设置可能与用于编写和测试代码的计算机不同**。

=== 什么是 Amazon ECS？

> - Amazon ECS **管理容器**，并**允许开发人员在云中运行应用程序**，而**无需为代码运行配置环境**。
> - 它使拥有 AWS 账户的**开发人员**能够**通过应用程序接口 （API） 调用**和**任务定义**，**部署和管理**在称为**集群的服务器组**上**运行的可扩展应用程序**。
> - Amazon ECS 使开发人员能够**轻松地将 Docker 容器**用于一系列活动。从**托管简单的网站**到**运行需要数千个容器的复杂分布式微服务**。

=== 架构图

image::/图片/79图片/架构图.png[架构图]

== 实验步骤

=== 使用 Fargate 开始使用 Amazon ECS

> - 您可以通过在 AWS Fargate 上**启动您的服务或任务**，将**容器托管**在**由 Amazon ECS 管理的无服务器基础设施上**。
> - 我们将开始使用 AWS Fargate 部署 Amazon ECS，方法是**您的任务使用 Fargate 启动类型**。

---

=== 创建容器和任务定义

> - 任务定义类似于**应用程序的蓝图**。
> - 每次在 Amazon ECS 中**启动任务时**，都必须**指定任务定义**。
> - 然后，服务知道要**用于容器的 Docker 映像**、要在任务中使用的**容器数**以及**每个容器的资源分配**。
> - 请确保您位于**美国东部（弗吉尼亚北部）**us-east-1 区域
> - 菜单**导航到 ECS**。
> - 在左上角，单击 Amazon ECS 下的**集群选项**。
> - 单击**"开始使用"**。

image::/图片/79图片/开始使用.png[开始使用]

> - 容器定义
> * 对于容器定义，运行向导**预加载了控制台中的**``示例应用``** **、**``nginx``** 和 **``tomcat-Web``** 服务器**容器定义**。
> * 向下滚动到**"容器定义"**部分，我们将为此实验室选择**``sample-app``**。

image::/图片/79图片/容器定义.png[容器定义]

> - 任务定义
> * 向下滚动以**查找任务定义**，运行向导将**定义要与预加载的容器**定义一起使用的**任务定义**。
> * 将**所有内容保留为默认值**。
> * 为简单起见，在运行向导中**创建的任务定义仅限于单个容器**。
> * 您可以稍后在 Amazon ECS 控制台中**创建多容器任务定义**。
> - 点击**下一步**

---

=== 定义您的服务

> - 在这一部分中，我们必须选择**如何配置根据任务定义创建的 Amazon ECS 服务**。
> - 服务允许我们在 ECS 集群中**运行和维护**任务定义的**同时实例的指定数量（"所需计数"）**。
> - Amazon ECS 示例应用程序是一个**基于 Web 的 Hello World 风格的应用程序**，旨在**无限期运行**。
> - 将所有内容**保留为默认值**，然后单击**下一步**

image::/图片/79图片/定义服务.png[定义服务]

---

=== 配置集群

> - 在**"集群名称**"字段中，输入为**集群的名称**。（我的情况：aws-cluster）
> * 注意：每个区域的每个账户的**集群名称都是唯一的**。
> - 单击**"下一步"**继续。

image::/图片/79图片/配置集群.png[配置集群]

---

=== 审核

> - 在**创建任务定义**、**服务**和**集群**之前，请**查看您的配置**。
> - 向下滚动并单击**创建**按钮。
> - 您将被定向到显示启动状态的**"启动状态"**页面。
> - 它描述了**该过程的每个步骤**（在创建和填充 Auto Scaling 组时，可能需要几分钟才能完成）。

image::/图片/79图片/启动状态.png[启动状态]

> - 创建资源后，单击**"查看服务"**按钮。

---

=== 查看服务

> - 您**已成功创建服务**。
> - 您的服务是**基于 Web 的应用程序（ Amazon ECS 示例应用程序）**，则可以**使用 Web 浏览器**查看其容器。
> - 在服务：**``sample-app-service``**页上，选择**"任务"**选项卡。
> - 从服务中的任务列表中**选择存在的任务**。
> - 向下**滚动到网络部分**，然后单击**任务的 ENI ID**。
> - 这会将您**带到 Amazon EC2 控制台**，您可以在其中查看与您的**任务关联**的**网络接口的详细信息**，包括 **IPv4 公有 IP 地址**。向下滚动**"详细信息"**部分以**查找公有 IPv4 地址**。

image::/图片/79图片/公有ip.png[公有ip]


> - **复制公有 IPv4 IP 地址**并**在 Web 浏览器中输入该地址**，您应该会**看到一个显示 Amazon ECS 示例应用程序的网页**。

image::/图片/79图片/验证.png[验证]

---
